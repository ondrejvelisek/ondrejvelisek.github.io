<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">What is great on hooks &amp; forget in RSC? | Ondrej Velisek</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://ondrejvelisek.github.io/img/torrta-logo.png"><meta data-rh="true" name="twitter:image" content="https://ondrejvelisek.github.io/img/torrta-logo.png"><meta data-rh="true" property="og:url" content="https://ondrejvelisek.github.io/blog/2024/02/23/what-the-f-is-f/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="What is great on hooks &amp; forget in RSC? | Ondrej Velisek"><meta data-rh="true" name="description" content="UI = f(state). Every one of us knows this formula. But how does it translate to real world?"><meta data-rh="true" property="og:description" content="UI = f(state). Every one of us knows this formula. But how does it translate to real world?"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2024-02-23T00:00:00.000Z"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://ondrejvelisek.github.io/blog/2024/02/23/what-the-f-is-f/"><link data-rh="true" rel="alternate" href="https://ondrejvelisek.github.io/blog/2024/02/23/what-the-f-is-f/" hreflang="en"><link data-rh="true" rel="alternate" href="https://ondrejvelisek.github.io/blog/2024/02/23/what-the-f-is-f/" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Ondrej Velisek RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Ondrej Velisek Atom Feed"><link rel="stylesheet" href="/assets/css/styles.5c1f732f.css">
<script src="/assets/js/runtime~main.7bbcfb75.js" defer="defer"></script>
<script src="/assets/js/main.cf96745f.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_G6ar" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbar--dark"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/torrta-logo.png" alt="torrta Logo" class="themedComponent_DHUr themedComponent--light_DIHH"><img src="/img/torrta-logo.png" alt="torrta Logo" class="themedComponent_DHUr themedComponent--dark_Bv2M"></div></a><a class="navbar__item navbar__link" href="/docs/What is Torrta/">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog/">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/ondrejvelisek/torrta" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_awgD"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbarSearchContainer_bmvg"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_UyTV"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_RYHo thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_sRjx margin-bottom--md">Recent posts</div><ul class="sidebarItemList_uMtB clean-list"><li class="sidebarItem_rygH"><a aria-current="page" class="sidebarItemLink_EKgd sidebarItemLinkActive_hRXJ" href="/blog/2024/02/23/what-the-f-is-f/">What is great on hooks &amp; forget in RSC?</a></li><li class="sidebarItem_rygH"><a class="sidebarItemLink_EKgd" href="/blog/2022/03/23/practical-limits-of-react-hooks-recursion/">Practical limits of React hooks - Recursion</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="https://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="UI = f(state). Every one of us knows this formula. But how does it translate to real world?"><header><h1 class="title_cIQJ" itemprop="headline">What is great on hooks &amp; forget in RSC?</h1><div class="container_PuMg margin-vert--md"><time datetime="2024-02-23T00:00:00.000Z" itemprop="datePublished">February 23, 2024</time> · <!-- -->6 min read</div></header><div id="__blog-post-container" class="markdown" itemprop="articleBody"><p><code>UI = f(state)</code>. Every one of us knows this formula. But how does it translate to real world?
What is <code>UI</code>? What is <code>state</code>? And what the f* is <em><code>f</code></em>? Here is my view.</p>
<p>I ignore how state is mutated. But I reckon it can mutate.</p>
<p><img decoding="async" loading="lazy" src="/assets/images/state-f-UI-150b8e18eed68d44470587431e671f2f.png" title="UI is a function of State" width="1920" height="960" class="img__Ss2"></p>
<h2 class="anchor anchorWithStickyNavbar_fF9Z" id="what-is-state">What is <code>state</code>?<a href="#what-is-state" class="hash-link" aria-label="Direct link to what-is-state" title="Direct link to what-is-state">​</a></h2>
<p>Look again: <code>UI = f(state)</code>. In other words <code>state</code> is what our <code>UI</code> depends on. If dependency changes, we want to change the UI. It is called reactivity.</p>
<p>I believe the <code>state</code> is more than just in-memory local component state (<code>useState</code>) or in-memory global app state (Redux, Jotai, Zustand).
I&#x27;m not alone (
<a href="https://tkdodo.eu/blog/react-query-as-a-state-manager" target="_blank" rel="noopener noreferrer">TkDodo</a>,
<a href="https://www.youtube.com/watch?v=ukpgxEemXsk" target="_blank" rel="noopener noreferrer">ByteGrad (YouTube)</a>,
<a href="https://x.com/kentcdodds/status/1349173470567964673" target="_blank" rel="noopener noreferrer">Kent C. Dodds</a>,
<a href="https://daverupert.com/2024/02/ui-states/" target="_blank" rel="noopener noreferrer">Dave Rupert</a>,
<a href="https://overreacted.io/the-two-reacts/" target="_blank" rel="noopener noreferrer">Dan Abramov</a>
). Many devs agrees at least URL and server data are some kind of state too. But I think it is much more. Lets place some <code>UI</code> examples:</p>
<ul>
<li>Blog post <code>UI</code> depends on slug present in <em>URL</em> address.</li>
<li>Server files <code>UI</code> explorer depends on <em>server files</em>.</li>
<li>Newest movies list <code>UI</code> depends on <em>external resource</em> of OMDB.</li>
<li>Ticking clock <code>UI</code> depends on <em>time</em>.</li>
<li>Drawing canvas <code>UI</code> depends on <em>mouse</em> position.</li>
<li>User profile <code>UI</code> depends on session token stored in <em>cookie</em>.</li>
<li>Keep me signed on this device <code>UI</code> depends on flag in <em>local storage</em>.</li>
<li>OS prefered dark mode <code>UI</code> depends on <em>OS setting</em>.</li>
<li>Devtools debug <code>UI</code> depends on <em>env variable</em>.</li>
<li>Panoramatic background <code>UI</code> depends on scroll position of <em>DOM</em> element.</li>
<li>... OK you got the idea.</li>
</ul>
<p>Its important to say that <code>state</code> may be <strong>derived</strong>. Examples:</p>
<ul>
<li>Current post <em>slug</em> depends on <em>URL</em>.</li>
<li>Current post <em>minutes read</em> depends on slug in <em>URL</em> and <em>server files</em>.</li>
<li>Current <em>user role</em> depends on <em>server database</em> authorization data and session token stored in <em>cookie</em>.</li>
<li><em>Prefered dark mode</em> depends on <em>local storage</em> and <em>OS setting</em> (storage as user preference and OS as default).</li>
<li>Arkanoid <em>paddle position</em> depends on <em>time</em> and arrow <em>pressed keys</em></li>
<li>... got it?</li>
</ul>
<p>Derived state depends on another state. And should change when its dependencies changes.
In other words, be reactive. Great article from <a href="https://reacttraining.com/blog/derived-state" target="_blank" rel="noopener noreferrer">React Training - Derived State</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_fF9Z" id="what-is-ui">What is <code>UI</code>?<a href="#what-is-ui" class="hash-link" aria-label="Direct link to what-is-ui" title="Direct link to what-is-ui">​</a></h2>
<p>It is what users perceive with their senses. Usually with eyes on screen. On web it is represented with <em>DOM</em>.
It could be also sounds playing, haptic vibration feedback, flashlight, etc. But lets stick only with <em>DOM</em> for now.</p>
<p>As dev I expect framework to provide tools to update <em>DOM</em> when state or derived state changes.
In React it is VDOM.</p>
<p>Note that <em>DOM</em> is classified as both <code>UI</code> and <code>state</code>. If we use <em>DOM</em> as state and let our UI depends on it, we create cyclic dependency.
Be careful in such situation to not create infinite loops.</p>
<p><img decoding="async" loading="lazy" src="/assets/images/what-the-f-is-f-4b793ba7d089e77ce02d7f0116d87007.png" title="What the f* is f?" width="1920" height="960" class="img__Ss2"></p>
<h2 class="anchor anchorWithStickyNavbar_fF9Z" id="what-the-f-is-f">What the f* is <em><code>f</code></em>?<a href="#what-the-f-is-f" class="hash-link" aria-label="Direct link to what-the-f-is-f" title="Direct link to what-the-f-is-f">​</a></h2>
<p><em><code>f</code></em> is something which connects <code>state</code> and <code>UI</code>.
You may say it is component tree with its render function. And you are IMO partialy right.</p>
<p>Because this <em><code>f</code></em> function usually produces maaaaany UI pieces,
it is &quot;neccesity&quot; to split the mental load into reusable smaller <code>f</code>s - components.
<a href="https://overreacted.io/a-chain-reaction/" target="_blank" rel="noopener noreferrer">Dan Abramov</a> great article about it.
There are some properties component must meet to be helpful.</p>
<ol>
<li>Composable - Ability to compose components into the full UI. Obviously.</li>
<li>Reusable - Ability to define name and reuse component in different place. Also ability to pass arbitrary configuration (possibly reactive state) to adjust its behavior (props).</li>
<li>Colocated - Name, render logic, necessary state connetions, state derivation logic, documentation etc. should be placed within/beside component. If not, devs jumps back and forth in a codebase. Inconvenient.</li>
<li>Encapsulated - Ability to work on a component independently by default. Opt-in to break barier. If not met, dev must mentaly thing about other code pieces. Which brings back the mental load.</li>
<li>Reactive - Component must react on connected state the dev chooses. Any component on any state. If some rules are required to connect some state, it makes the development jammed.</li>
<li>Arbitrary - The components boundaries must obey to the dev needs. If something forces component to split (or not to split), it effectivly removing the reason why components exists.</li>
</ol>
<p>Example. React components ergonomics.</p>
<div class="language-tsx codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_qZBB"><pre tabindex="0" class="prism-code language-tsx codeBlock_TAPP thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#bfc7d5"><span class="token plain">fucntion </span><span class="token function" style="color:rgb(130, 170, 255)">Post</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">slug</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">                  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Name and state received via props</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> posts </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">useQuery</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">fetchPosts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// state received via hook</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> post </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> posts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">slug</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">           </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// derivation logic</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">post</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">           </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// JSX UI description</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup_TNwR"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_MVhB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_yxgH"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_QJLJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><strong>Name</strong> of function to be referencable.</li>
<li><strong>Receive state</strong> via props or hooks (or higher order components).</li>
<li><strong>Derive state</strong> before JSX is produced. Right within render function or separated into custom function.</li>
<li><strong>Produce UI description</strong> in a form of JSX which is then consumed by VDOM.</li>
</ul>
<p>I said partialy. Components does not directly connects to states. They just receives a value/connection.</p>
<p><img decoding="async" loading="lazy" src="/assets/images/render-is-not-f-1800ec95e683295f750220bb6a5bdc01.png" title="f is not just component tree render function" width="1920" height="960" class="img__Ss2"></p>
<h2 class="anchor anchorWithStickyNavbar_fF9Z" id="hooks-to-connect-state">Hooks to connect state<a href="#hooks-to-connect-state" class="hash-link" aria-label="Direct link to Hooks to connect state" title="Direct link to Hooks to connect state">​</a></h2>
<p>We need some way to choose states our component depends on. We want to subscribe/observe changes and execute derivation and rendering logic with new values.</p>
<p>Hooks do a great job with its smart <code>useEffect</code> and <code>useRef</code>. Much hated for its ergonomics, but IMO does the job conceptually right.
Lets call custom hooks using <code>useEffect</code> and <code>useRef</code> <strong>connection hooks</strong>.</p>
<p>Many libraries like <code>tanstack-query</code> for external resources, <code>react-router</code> for URL or <code>react-use</code> for many kind of states were created.
They allows us (app devs) to connect to the state with one line of code from within the component. And dont car much how.
Reusable, colocated, encapsulated, reactive.</p>
<p>Those connecting hooks are a missing glue between state and a component render logic.
They subscribe to the state changes and make necessary derivation and rednering logic re-run accordingly.</p>
<p><img decoding="async" loading="lazy" src="/assets/images/hooks-fcd3a4b6afb5b3ff3ef4ec0f155945df.png" title="Hooks allows to connect to all kind of states" width="1920" height="960" class="img__Ss2"></p>
<p>IMO observer pattern is best for DX. But sometimes it is not possible or wanted usually for performance.
Typically for states far away from client like server data.
Even for them we have mechanisms like websockets or long polling.
But usually we fallback to initial fetch during either component mount, server request or build.
Then caching, invalidation and optimistic update mechanisms must enter the scene.
But call them connecting hooks anyway.</p>
<p>There are hooks which creates in-memory local component state itself <code>useState</code> and <code>useReducer</code>.
But lets stick with connecting word too.</p>
<h2 class="anchor anchorWithStickyNavbar_fF9Z" id="answer">Answer<a href="#answer" class="hash-link" aria-label="Direct link to Answer" title="Direct link to Answer">​</a></h2>
<div class="language-js codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_qZBB"><pre tabindex="0" class="prism-code language-js codeBlock_TAPP thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#bfc7d5"><span class="token constant" style="color:rgb(130, 170, 255)">UI</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">f</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">render</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">derive</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">connect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup_TNwR"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_MVhB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_yxgH"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_QJLJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This is conceptually clean and mentally relieving model. I believe many devs love React 16.8+ because of those principles.
I&#x27;m afraid new React server components breaks some of its beauty.
But lets close this post short a positive and keep this topic till the next time. :)</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--next" href="/blog/2022/03/23/practical-limits-of-react-hooks-recursion/"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Practical limits of React hooks - Recursion</div></a></nav></main><div class="col col--2"><div class="tableOfContents_TN1Q thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#what-is-state" class="table-of-contents__link toc-highlight">What is <code>state</code>?</a></li><li><a href="#what-is-ui" class="table-of-contents__link toc-highlight">What is <code>UI</code>?</a></li><li><a href="#what-the-f-is-f" class="table-of-contents__link toc-highlight">What the f* is <em><code>f</code></em>?</a></li><li><a href="#hooks-to-connect-state" class="table-of-contents__link toc-highlight">Hooks to connect state</a></li><li><a href="#answer" class="table-of-contents__link toc-highlight">Answer</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright"><div class="flex justify-between">
        <div>Copyright © 2024 Ondrej Velisek</div>
        <div>Made with ❤️ in Czech republic.</div>
      </div></div></div></div></footer></div>
</body>
</html>