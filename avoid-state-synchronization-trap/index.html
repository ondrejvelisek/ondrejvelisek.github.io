<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Avoid the State Synchronization Trap | Ondrej Velisek</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://ondrejvelisek.github.io/avoid-state-synchronization-trap/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Avoid the State Synchronization Trap | Ondrej Velisek"><meta data-rh="true" name="description" content="This post is about a bad code pattern I see quite often."><meta data-rh="true" property="og:description" content="This post is about a bad code pattern I see quite often."><meta data-rh="true" property="og:image" content="https://ondrejvelisek.github.io/assets/images/avoid-state-sync-trap-diagram-41eb1aaa06484971c6980e9471db0f0b.png"><meta data-rh="true" name="twitter:image" content="https://ondrejvelisek.github.io/assets/images/avoid-state-sync-trap-diagram-41eb1aaa06484971c6980e9471db0f0b.png"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2025-04-14T00:00:00.000Z"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://ondrejvelisek.github.io/avoid-state-synchronization-trap/"><link data-rh="true" rel="alternate" href="https://ondrejvelisek.github.io/avoid-state-synchronization-trap/" hreflang="en"><link data-rh="true" rel="alternate" href="https://ondrejvelisek.github.io/avoid-state-synchronization-trap/" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://ondrejvelisek.github.io/avoid-state-synchronization-trap","mainEntityOfPage":"https://ondrejvelisek.github.io/avoid-state-synchronization-trap","url":"https://ondrejvelisek.github.io/avoid-state-synchronization-trap","headline":"Avoid the State Synchronization Trap","name":"Avoid the State Synchronization Trap","description":"This post is about a bad code pattern I see quite often.","datePublished":"2025-04-14T00:00:00.000Z","author":[],"image":{"@type":"ImageObject","@id":"https://ondrejvelisek.github.io/assets/images/avoid-state-sync-trap-diagram-41eb1aaa06484971c6980e9471db0f0b.png","url":"https://ondrejvelisek.github.io/assets/images/avoid-state-sync-trap-diagram-41eb1aaa06484971c6980e9471db0f0b.png","contentUrl":"https://ondrejvelisek.github.io/assets/images/avoid-state-sync-trap-diagram-41eb1aaa06484971c6980e9471db0f0b.png","caption":"title image for the blog post: Avoid the State Synchronization Trap"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://ondrejvelisek.github.io/","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/rss.xml" title="Ondrej Velisek RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Ondrej Velisek Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-BZWT5GPVTE"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-BZWT5GPVTE",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.a8199a96.css">
<script src="/assets/js/runtime~main.42136423.js" defer="defer"></script>
<script src="/assets/js/main.1b07950e.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/ondrejvelisek-logo.svg"><link rel="preload" as="image" href="/assets/images/about_avatar-24834c1f63d619bcb8911cf6f2542456.webp"><div role="region" aria-label="Skip to main content"><a class="skipToContent_vI9N" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbar--dark"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/ondrejvelisek-logo.svg" alt="ondrejvelisek Logo" class="themedComponent_x2kJ themedComponent--light_yLPm"><img src="/img/ondrejvelisek-logo.svg" alt="ondrejvelisek Logo" class="themedComponent_x2kJ themedComponent--dark_ndWy"></div></a></div><div class="navbar__items navbar__items--right"><div class="navbarSearchContainer_DudH"></div></div></div><a href="/about" class="block"><img src="/assets/images/about_avatar-24834c1f63d619bcb8911cf6f2542456.webp" alt="Photo of Ondrej Velisek which leads to about page" class="size-11 min-w-11 min-h-11 border border-solid border-white hover:border-[var(--ifm-link-color)] transition-colors rounded-full"></a><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_MWqU"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_DpSO thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_yzVa margin-bottom--md">All posts</div><div role="group"><h3 class="yearGroupHeading_uu0Z">2025</h3><ul class="sidebarItemList_Rq9m clean-list"><li class="sidebarItem_tvmX"><a class="sidebarItemLink_DPHx" href="/tanstack-start-new-competitor-to-nextjs/">TanStack Start: New competitor to Next.js</a></li><li class="sidebarItem_tvmX"><a aria-current="page" class="sidebarItemLink_DPHx sidebarItemLinkActive_B_1E" href="/avoid-state-synchronization-trap/">Avoid the State Synchronization Trap</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_uu0Z">2024</h3><ul class="sidebarItemList_Rq9m clean-list"><li class="sidebarItem_tvmX"><a class="sidebarItemLink_DPHx" href="/how-nextjs-breaks-react-fundamentals/">How Next.js breaks React Fundamentals (Examples)</a></li><li class="sidebarItem_tvmX"><a class="sidebarItemLink_DPHx" href="/conceptual-model-of-react-and-rsc/">Conceptual Model of React and RSC</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_uu0Z">2022</h3><ul class="sidebarItemList_Rq9m clean-list"><li class="sidebarItem_tvmX"><a class="sidebarItemLink_DPHx" href="/practical-limits-of-react-hooks-recursion/">Practical limits of React hooks - Recursion</a></li></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class="title_PojJ">Avoid the State Synchronization Trap</h1><div class="container_Huic margin-vert--md"><time datetime="2025-04-14T00:00:00.000Z">April 14, 2025</time> · <!-- -->12 min read</div></header><div id="__blog-post-container" class="markdown"><p>This post is about a bad code pattern I see quite often.
It’s about state management, particularly state synchronization. Often it is a source of bugs, glitches, and performance problems.</p>
<p>Usually it is solvable by adjusting the state shape.
More precisely, splitting the state into pieces and merging the pieces later in selectors, render functions, or custom hooks.
An interesting fact is that one of those states is empty or undefined, but the UI renders desired items anyway. It might seem unintuitive, but bear with me.</p>
<!-- -->
<p>During the Redux era, we discussed state shape a lot. It was called state normalization.
Nowadays, it is rarely touched, even though it is still important.
To make my thoughts easier to understand, I sometimes use Redux terminology, like selectors and actions, throughout this article.</p>
<p>I’ll present the problem using an example of an orders table. The example is quite long, but I believe it is useful.
It is based on a real-world application. I simplify, but in principle, I saw it in a real codebase.</p>
<p>One last note before we start: I talk about React but the ideas are applicable to any modern FE framework (regardless if signal-based or not).</p>
<p> </p>
<h2 class="anchor anchorWithStickyNavbar_BFL_" id="example">Example<a href="#example" class="hash-link" aria-label="Direct link to Example" title="Direct link to Example">​</a></h2>
<p>Let’s illustrate state synchronization through an evolving example, starting simply and becoming increasingly complex over several hypothetical years.</p>
<p> </p>
<h3 class="anchor anchorWithStickyNavbar_BFL_" id="2025-list-of-orders">2025: List of Orders<a href="#2025-list-of-orders" class="hash-link" aria-label="Direct link to 2025: List of Orders" title="Direct link to 2025: List of Orders">​</a></h3>
<!-- -->
<table class="mb-0"><thead><tr class="bg-[#1B1B1D]"><th>Date        </th><th>#     </th><th>Customer</th><th>Amount</th></tr></thead><tbody><tr class="even:bg-inherit"><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td></tr><tr class="even:bg-inherit"><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td></tr><tr class="even:bg-inherit"><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td></tr></tbody></table>
<div class="language-tsx codeBlockContainer_t37y theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#212432"><div class="codeBlockContent_evnz"><pre tabindex="0" class="prism-code language-tsx codeBlock_eucs thin-scrollbar" style="color:#9CDCFE;background-color:#212432"><code class="codeBlockLines_ir7E"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">OrdersList</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> orders </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">useOrders</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> </span><span class="token tag punctuation" style="color:rgb(212, 212, 212)">&lt;</span><span class="token tag class-name" style="color:rgb(78, 201, 176)">Table</span><span class="token tag" style="color:rgb(78, 201, 176)"> </span><span class="token tag attr-name" style="color:rgb(156, 220, 254)">data</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(212, 212, 212)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token tag script language-javascript" style="color:rgb(78, 201, 176)">orders</span><span class="token tag script language-javascript punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token tag" style="color:rgb(78, 201, 176)"> </span><span class="token tag punctuation" style="color:rgb(212, 212, 212)">/&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre><div class="buttonGroup_WgNt"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Grdj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_cxvn"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_I15G"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>It’s the year 2025, and you work on this cool project called Outstanding Overview of Opulus Orders (OOoOO).
You work on a page with a data table: a list of orders.
Component <code>OrdersList</code> uses hook <code>useOrders</code>, which internally uses TanStack Query to fetch orders from a backend API.
With the given orders data, you use a UI component <code>Table</code>, which renders it. Easy peasy.</p>
<p> </p>
<h3 class="anchor anchorWithStickyNavbar_BFL_" id="2026-custom-columns">2026: Custom Columns<a href="#2026-custom-columns" class="hash-link" aria-label="Direct link to 2026: Custom Columns" title="Direct link to 2026: Custom Columns">​</a></h3>
<!-- -->
<div class="flex items-start"><table class="mb-0"><thead><tr class="bg-[#1B1B1D]"><th>Date        </th><th>#     </th><th>Customer</th><th>Amount</th></tr></thead><tbody><tr class="even:bg-inherit"><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td></tr><tr class="even:bg-inherit"><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td></tr><tr class="even:bg-inherit"><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td></tr></tbody></table><div class="relative group"><button class="group-first:rounded-s group-last:rounded-e transition-colors hover:bg-[rgba(255,255,255,0.15)] bg-[rgba(255,255,255,0.07)] shadow-inner border border-[#606770] border-solid p-3 text-base font-bold text-[rgb(227,227,227)] leading-[26px] cursor-pointer hover:text-white border-l-0 group-first:border-l font-[inherit]"><span class="font-[Arial] text-2xl leading-[23px]">⚙</span></button><div class="transition-[max-height,padding,opacity] rounded-b py-1 overflow-hidden border border-[#606770] border-solid border-t-0 z-10 absolute bg-[#1B1B1D] group-last:right-0 -left-px group-last:left-auto group-first:left-auto flex-col shadow-black shadow-lg min-w-[calc(100%+1px)]" style="padding:0px;opacity:0.5;border-bottom-width:0px;max-height:0px"><label class="px-2 py-1 truncate block"><input type="checkbox" id="date" checked="" value="date">Date        </label><label class="px-2 py-1 truncate block"><input type="checkbox" id="id" checked="" value="id">#     </label><label class="px-2 py-1 truncate block"><input type="checkbox" id="customer" checked="" value="customer">Customer</label><label class="px-2 py-1 truncate block"><input type="checkbox" id="amount" checked="" value="amount">Amount</label><label class="px-2 py-1 truncate block"><input type="checkbox" id="currency" value="currency">Currency</label><label class="px-2 py-1 truncate block"><input type="checkbox" id="country" value="country">Country </label></div></div></div>
<div class="language-tsx codeBlockContainer_t37y theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#212432"><div class="codeBlockContent_evnz"><pre tabindex="0" class="prism-code language-tsx codeBlock_eucs thin-scrollbar" style="color:#9CDCFE;background-color:#212432"><code class="codeBlockLines_ir7E"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">OrdersList</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">columns</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">useContext</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token maybe-class-name">ColumnsCtx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> orders </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">useOrders</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">columns</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> </span><span class="token tag punctuation" style="color:rgb(212, 212, 212)">&lt;</span><span class="token tag class-name" style="color:rgb(78, 201, 176)">Table</span><span class="token tag" style="color:rgb(78, 201, 176)"> </span><span class="token tag attr-name" style="color:rgb(156, 220, 254)">data</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(212, 212, 212)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token tag script language-javascript" style="color:rgb(78, 201, 176)">orders</span><span class="token tag script language-javascript punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token tag" style="color:rgb(78, 201, 176)"> </span><span class="token tag punctuation" style="color:rgb(212, 212, 212)">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre><div class="buttonGroup_WgNt"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Grdj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_cxvn"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_I15G"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-tsx codeBlockContainer_t37y theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#212432"><div class="codeBlockContent_evnz"><pre tabindex="0" class="prism-code language-tsx codeBlock_eucs thin-scrollbar" style="color:#9CDCFE;background-color:#212432"><code class="codeBlockLines_ir7E"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> initColumns </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> attribute</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;date&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> attribute</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;order&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> attribute</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;customer&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> attribute</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;amount&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">ColumnsProvider</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">columns</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> setColumns</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">useState</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">initColumns</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token spread operator" style="color:rgb(212, 212, 212)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre><div class="buttonGroup_WgNt"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Grdj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_cxvn"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_I15G"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Fast forward. It’s the year 2026, and your customer’s business has grown internationally, introducing new requirements.
They collect additional attributes about Opulus orders, like currency and country.
They want to allow users to show more columns in the table. So you add a <code>⚙</code> button beside the table header.
When the user clicks it, a dropdown with available columns appears. The user can select and deselect which columns are visible.</p>
<p>Since visible columns might change, they can’t be a constant and you need to store them in some kind of updatable state.
They need to be accessed from multiple components (like <code>OrdersList</code> and the <code>⚙</code> button dropdown).
To avoid prop drilling, we store columns in some higher-level state.
Here I use React Context <code>ColumnsCtx</code>, but feel free to imagine Zustand, Jotai, Redux, or URL. It does not matter for our purposes.
You initialize the state with a constant containing the default columns.
(If URL surprised you, you might want to read my previous article <a href="/conceptual-model-of-react-and-rsc/">Conceptual Model of React and RSC</a>).</p>
<p> </p>
<h3 class="anchor anchorWithStickyNavbar_BFL_" id="2027-filters">2027: Filters<a href="#2027-filters" class="hash-link" aria-label="Direct link to 2027: Filters" title="Direct link to 2027: Filters">​</a></h3>
<!-- -->
<div class="flex mb-2 w-full flex-wrap"><div class="relative group"><button class="group-first:rounded-s group-last:rounded-e transition-colors hover:bg-[rgba(255,255,255,0.15)] bg-[rgba(255,255,255,0.07)] shadow-inner border border-[#606770] border-solid p-3 text-base font-bold text-[rgb(227,227,227)] leading-[26px] cursor-pointer hover:text-white border-l-0 group-first:border-l font-[inherit]">Date        </button><div class="transition-[max-height,padding,opacity] rounded-b py-1 overflow-hidden border border-[#606770] border-solid border-t-0 z-10 absolute bg-[#1B1B1D] group-last:right-0 -left-px group-last:left-auto group-first:left-auto flex-col shadow-black shadow-lg min-w-[calc(100%+1px)]" style="padding:0px;opacity:0.5;border-bottom-width:0px;max-height:0px"></div></div><div class="relative group"><button class="group-first:rounded-s group-last:rounded-e transition-colors hover:bg-[rgba(255,255,255,0.15)] bg-[rgba(255,255,255,0.07)] shadow-inner border border-[#606770] border-solid p-3 text-base font-bold text-[rgb(227,227,227)] leading-[26px] cursor-pointer hover:text-white border-l-0 group-first:border-l font-[inherit]">#     </button><div class="transition-[max-height,padding,opacity] rounded-b py-1 overflow-hidden border border-[#606770] border-solid border-t-0 z-10 absolute bg-[#1B1B1D] group-last:right-0 -left-px group-last:left-auto group-first:left-auto flex-col shadow-black shadow-lg min-w-[calc(100%+1px)]" style="padding:0px;opacity:0.5;border-bottom-width:0px;max-height:0px"></div></div><div class="relative group"><button class="group-first:rounded-s group-last:rounded-e transition-colors hover:bg-[rgba(255,255,255,0.15)] bg-[rgba(255,255,255,0.07)] shadow-inner border border-[#606770] border-solid p-3 text-base font-bold text-[rgb(227,227,227)] leading-[26px] cursor-pointer hover:text-white border-l-0 group-first:border-l font-[inherit]">Customer</button><div class="transition-[max-height,padding,opacity] rounded-b py-1 overflow-hidden border border-[#606770] border-solid border-t-0 z-10 absolute bg-[#1B1B1D] group-last:right-0 -left-px group-last:left-auto group-first:left-auto flex-col shadow-black shadow-lg min-w-[calc(100%+1px)]" style="padding:0px;opacity:0.5;border-bottom-width:0px;max-height:0px"></div></div><div class="relative group"><button class="group-first:rounded-s group-last:rounded-e transition-colors hover:bg-[rgba(255,255,255,0.15)] bg-[rgba(255,255,255,0.07)] shadow-inner border border-[#606770] border-solid p-3 text-base font-bold text-[rgb(227,227,227)] leading-[26px] cursor-pointer hover:text-white border-l-0 group-first:border-l font-[inherit]">Amount</button><div class="transition-[max-height,padding,opacity] rounded-b py-1 overflow-hidden border border-[#606770] border-solid border-t-0 z-10 absolute bg-[#1B1B1D] group-last:right-0 -left-px group-last:left-auto group-first:left-auto flex-col shadow-black shadow-lg min-w-[calc(100%+1px)]" style="padding:0px;opacity:0.5;border-bottom-width:0px;max-height:0px"></div></div></div><div class="flex items-start"><table class="mb-0"><thead><tr class="bg-[#1B1B1D]"><th>Date        </th><th>#     </th><th>Customer</th><th>Amount</th></tr></thead><tbody><tr class="even:bg-inherit"><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td></tr><tr class="even:bg-inherit"><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td></tr><tr class="even:bg-inherit"><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td></tr></tbody></table><div class="relative group"><button class="group-first:rounded-s group-last:rounded-e transition-colors hover:bg-[rgba(255,255,255,0.15)] bg-[rgba(255,255,255,0.07)] shadow-inner border border-[#606770] border-solid p-3 text-base font-bold text-[rgb(227,227,227)] leading-[26px] cursor-pointer hover:text-white border-l-0 group-first:border-l font-[inherit]"><span class="font-[Arial] text-2xl leading-[23px]">⚙</span></button><div class="transition-[max-height,padding,opacity] rounded-b py-1 overflow-hidden border border-[#606770] border-solid border-t-0 z-10 absolute bg-[#1B1B1D] group-last:right-0 -left-px group-last:left-auto group-first:left-auto flex-col shadow-black shadow-lg min-w-[calc(100%+1px)]" style="padding:0px;opacity:0.5;border-bottom-width:0px;max-height:0px"><label class="px-2 py-1 truncate block"><input type="checkbox" id="date" checked="" value="date">Date        </label><label class="px-2 py-1 truncate block"><input type="checkbox" id="id" checked="" value="id">#     </label><label class="px-2 py-1 truncate block"><input type="checkbox" id="customer" checked="" value="customer">Customer</label><label class="px-2 py-1 truncate block"><input type="checkbox" id="amount" checked="" value="amount">Amount</label><label class="px-2 py-1 truncate block"><input type="checkbox" id="currency" value="currency">Currency</label><label class="px-2 py-1 truncate block"><input type="checkbox" id="country" value="country">Country </label></div></div></div>
<div class="language-tsx codeBlockContainer_t37y theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#212432"><div class="codeBlockContent_evnz"><pre tabindex="0" class="prism-code language-tsx codeBlock_eucs thin-scrollbar" style="color:#9CDCFE;background-color:#212432"><code class="codeBlockLines_ir7E"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">Filters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">filters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">useContext</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token maybe-class-name">FiltersCtx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> filters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">map</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">filter </span><span class="token arrow operator" style="color:rgb(212, 212, 212)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(212, 212, 212)">&lt;</span><span class="token tag class-name" style="color:rgb(78, 201, 176)">Filter</span><span class="token tag" style="color:rgb(78, 201, 176)"> </span><span class="token tag attr-name" style="color:rgb(156, 220, 254)">filter</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(212, 212, 212)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token tag script language-javascript" style="color:rgb(78, 201, 176)">filter</span><span class="token tag script language-javascript punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token tag" style="color:rgb(78, 201, 176)"> </span><span class="token tag punctuation" style="color:rgb(212, 212, 212)">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre><div class="buttonGroup_WgNt"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Grdj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_cxvn"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_I15G"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-tsx codeBlockContainer_t37y theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#212432"><div class="codeBlockContent_evnz"><pre tabindex="0" class="prism-code language-tsx codeBlock_eucs thin-scrollbar" style="color:#9CDCFE;background-color:#212432"><code class="codeBlockLines_ir7E"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">OrdersList</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">columns</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">useContext</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token maybe-class-name">ColumnsCtx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">filters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">useContext</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token maybe-class-name">FiltersCtx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> orders </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">useOrders</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">columns</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> filters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> </span><span class="token tag punctuation" style="color:rgb(212, 212, 212)">&lt;</span><span class="token tag class-name" style="color:rgb(78, 201, 176)">Table</span><span class="token tag" style="color:rgb(78, 201, 176)"> </span><span class="token tag attr-name" style="color:rgb(156, 220, 254)">data</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(212, 212, 212)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token tag script language-javascript" style="color:rgb(78, 201, 176)">orders</span><span class="token tag script language-javascript punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token tag" style="color:rgb(78, 201, 176)"> </span><span class="token tag punctuation" style="color:rgb(212, 212, 212)">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre><div class="buttonGroup_WgNt"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Grdj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_cxvn"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_I15G"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-tsx codeBlockContainer_t37y theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#212432"><div class="codeBlockContent_evnz"><pre tabindex="0" class="prism-code language-tsx codeBlock_eucs thin-scrollbar" style="color:#9CDCFE;background-color:#212432"><code class="codeBlockLines_ir7E"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">type</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">Filters</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:rgb(78, 201, 176)">Array</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  attribute</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">string</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  operator</span><span class="token operator" style="color:rgb(212, 212, 212)">?</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;=&#x27;</span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;&gt;&#x27;</span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;&lt;&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  values</span><span class="token operator" style="color:rgb(212, 212, 212)">?</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:rgb(78, 201, 176)">Array</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token builtin" style="color:rgb(86, 156, 214)">string</span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token builtin" style="color:rgb(86, 156, 214)">number</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">FiltersProvider</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">filters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> setFilters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">useState</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token spread operator" style="color:rgb(212, 212, 212)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre><div class="buttonGroup_WgNt"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Grdj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_cxvn"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_I15G"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Fast forward to 2027. The customer’s business continues to grow. There are many Opulus orders now.
Therefore, the customer wants you to implement filtering rows by values.
The user should be able to filter only visible columns.
Not a trivial feature request, but let’s do it.</p>
<p>You add a new <code>Filters</code> component.
Similarly to columns, the visible filters might change. They can’t be a constant and you need to store them in a state.
They are required by multiple components. So to avoid prop drilling, you store them in a new Context <code>FiltersCtx</code>.</p>
<p>Filtering works as follows:
The user selects a filter value, e.g., Customer ‘Ondrej’.
The state setter is called from <code>Filter</code> component.
The <code>FiltersCtx</code> state value is updated.
The reactivity system rerenders the <code>OrdersList</code> component.
<code>useOrders</code> hook receives updated state and refetches data with new <code>filters</code>.</p>
<p>You can try it by yourself with interactive working example above.</p>
<p> </p>
<h2 class="anchor anchorWithStickyNavbar_BFL_" id="state-initialization">State Initialization<a href="#state-initialization" class="hash-link" aria-label="Direct link to State Initialization" title="Direct link to State Initialization">​</a></h2>
<p>Seems nice. You try to run the code, and… it does not show any filters. Can you guess why?
(Note I’ve already fixed the example above, to illustrate what we are trying to build)</p>
<p>It is because the filters context is empty. We need to initialize the filter state.
<code>useState</code> has an initialization property. We can use it.</p>
<!-- -->
<div class="flex mb-2"><div class="relative group"><button class="group-first:rounded-s group-last:rounded-e transition-colors hover:bg-[rgba(255,255,255,0.15)] bg-[rgba(255,255,255,0.07)] shadow-inner border border-[#606770] border-solid p-3 text-base font-bold text-[rgb(227,227,227)] leading-[26px] cursor-pointer hover:text-white border-l-0 group-first:border-l font-[inherit]">Date        </button><div class="transition-[max-height,padding,opacity] rounded-b py-1 overflow-hidden border border-[#606770] border-solid border-t-0 z-10 absolute bg-[#1B1B1D] group-last:right-0 -left-px group-last:left-auto group-first:left-auto flex-col shadow-black shadow-lg min-w-[calc(100%+1px)]" style="padding:0px;opacity:0.5;border-bottom-width:0px;max-height:0px"></div></div><div class="relative group"><button class="group-first:rounded-s group-last:rounded-e transition-colors hover:bg-[rgba(255,255,255,0.15)] bg-[rgba(255,255,255,0.07)] shadow-inner border border-[#606770] border-solid p-3 text-base font-bold text-[rgb(227,227,227)] leading-[26px] cursor-pointer hover:text-white border-l-0 group-first:border-l font-[inherit]">#     </button><div class="transition-[max-height,padding,opacity] rounded-b py-1 overflow-hidden border border-[#606770] border-solid border-t-0 z-10 absolute bg-[#1B1B1D] group-last:right-0 -left-px group-last:left-auto group-first:left-auto flex-col shadow-black shadow-lg min-w-[calc(100%+1px)]" style="padding:0px;opacity:0.5;border-bottom-width:0px;max-height:0px"></div></div><div class="relative group"><button class="group-first:rounded-s group-last:rounded-e transition-colors hover:bg-[rgba(255,255,255,0.15)] bg-[rgba(255,255,255,0.07)] shadow-inner border border-[#606770] border-solid p-3 text-base font-bold text-[rgb(227,227,227)] leading-[26px] cursor-pointer hover:text-white border-l-0 group-first:border-l font-[inherit]">Customer</button><div class="transition-[max-height,padding,opacity] rounded-b py-1 overflow-hidden border border-[#606770] border-solid border-t-0 z-10 absolute bg-[#1B1B1D] group-last:right-0 -left-px group-last:left-auto group-first:left-auto flex-col shadow-black shadow-lg min-w-[calc(100%+1px)]" style="padding:0px;opacity:0.5;border-bottom-width:0px;max-height:0px"></div></div><div class="relative group"><button class="group-first:rounded-s group-last:rounded-e transition-colors hover:bg-[rgba(255,255,255,0.15)] bg-[rgba(255,255,255,0.07)] shadow-inner border border-[#606770] border-solid p-3 text-base font-bold text-[rgb(227,227,227)] leading-[26px] cursor-pointer hover:text-white border-l-0 group-first:border-l font-[inherit]">Amount</button><div class="transition-[max-height,padding,opacity] rounded-b py-1 overflow-hidden border border-[#606770] border-solid border-t-0 z-10 absolute bg-[#1B1B1D] group-last:right-0 -left-px group-last:left-auto group-first:left-auto flex-col shadow-black shadow-lg min-w-[calc(100%+1px)]" style="padding:0px;opacity:0.5;border-bottom-width:0px;max-height:0px"></div></div></div><div class="flex items-start"><table class="mb-0"><thead><tr class="bg-[#1B1B1D]"><th>Date        </th><th>#     </th><th>Customer</th><th>Amount</th></tr></thead><tbody><tr class="even:bg-inherit"><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td></tr><tr class="even:bg-inherit"><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td></tr><tr class="even:bg-inherit"><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td></tr></tbody></table><div class="relative group"><button class="group-first:rounded-s group-last:rounded-e transition-colors hover:bg-[rgba(255,255,255,0.15)] bg-[rgba(255,255,255,0.07)] shadow-inner border border-[#606770] border-solid p-3 text-base font-bold text-[rgb(227,227,227)] leading-[26px] cursor-pointer hover:text-white border-l-0 group-first:border-l font-[inherit]"><span class="font-[Arial] text-2xl leading-[23px]">⚙</span></button><div class="transition-[max-height,padding,opacity] rounded-b py-1 overflow-hidden border border-[#606770] border-solid border-t-0 z-10 absolute bg-[#1B1B1D] group-last:right-0 -left-px group-last:left-auto group-first:left-auto flex-col shadow-black shadow-lg min-w-[calc(100%+1px)]" style="padding:0px;opacity:0.5;border-bottom-width:0px;max-height:0px"><label class="px-2 py-1 truncate block"><input type="checkbox" id="date" checked="" value="date">Date        </label><label class="px-2 py-1 truncate block"><input type="checkbox" id="id" checked="" value="id">#     </label><label class="px-2 py-1 truncate block"><input type="checkbox" id="customer" checked="" value="customer">Customer</label><label class="px-2 py-1 truncate block"><input type="checkbox" id="amount" checked="" value="amount">Amount</label><label class="px-2 py-1 truncate block"><input type="checkbox" id="currency" value="currency">Currency</label><label class="px-2 py-1 truncate block"><input type="checkbox" id="country" value="country">Country </label></div></div></div>
<div class="language-tsx codeBlockContainer_t37y theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#212432"><div class="codeBlockContent_evnz"><pre tabindex="0" class="prism-code language-tsx codeBlock_eucs thin-scrollbar" style="color:#9CDCFE;background-color:#212432"><code class="codeBlockLines_ir7E"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> initColumns </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> attribute</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;date&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> attribute</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;order&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> attribute</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;customer&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> attribute</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;amount&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">FiltersProvider</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">filters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> setFilters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">useState</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">initColumns</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token spread operator" style="color:rgb(212, 212, 212)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre><div class="buttonGroup_WgNt"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Grdj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_cxvn"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_I15G"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>It shows the filters now. But…</p>
<p>When you add or remove columns, the filters are not updated.
The desired behavior is: when the user adds a new column, the filter for this column is also added.
In other words, synchronize columns and filters states.
Maybe this will help?</p>
<div class="language-tsx codeBlockContainer_t37y theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#212432"><div class="codeBlockContent_evnz"><pre tabindex="0" class="prism-code language-tsx codeBlock_eucs thin-scrollbar" style="color:#9CDCFE;background-color:#212432"><code class="codeBlockLines_ir7E"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">FiltersProvider</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">columns</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">useContext</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token maybe-class-name">ColumnsCtx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token spread operator" style="color:rgb(212, 212, 212)">...</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">useState</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">columns</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token spread operator" style="color:rgb(212, 212, 212)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre><div class="buttonGroup_WgNt"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Grdj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_cxvn"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_I15G"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Nope. Filters are still static because the <code>useState</code> argument is used at the first render only.
We need to update the filters state somehow.</p>
<p> </p>
<h2 class="anchor anchorWithStickyNavbar_BFL_" id="state-synchronization">State Synchronization<a href="#state-synchronization" class="hash-link" aria-label="Direct link to State Synchronization" title="Direct link to State Synchronization">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_BFL_" id="1-direct-setters-approach">1. Direct Setters Approach<a href="#1-direct-setters-approach" class="hash-link" aria-label="Direct link to 1. Direct Setters Approach" title="Direct link to 1. Direct Setters Approach">​</a></h3>
<!-- -->
<div class="flex mb-2"><div class="relative group"><button class="group-first:rounded-s group-last:rounded-e transition-colors hover:bg-[rgba(255,255,255,0.15)] bg-[rgba(255,255,255,0.07)] shadow-inner border border-[#606770] border-solid p-3 text-base font-bold text-[rgb(227,227,227)] leading-[26px] cursor-pointer hover:text-white border-l-0 group-first:border-l font-[inherit]">Date        </button><div class="transition-[max-height,padding,opacity] rounded-b py-1 overflow-hidden border border-[#606770] border-solid border-t-0 z-10 absolute bg-[#1B1B1D] group-last:right-0 -left-px group-last:left-auto group-first:left-auto flex-col shadow-black shadow-lg min-w-[calc(100%+1px)]" style="padding:0px;opacity:0.5;border-bottom-width:0px;max-height:0px"></div></div><div class="relative group"><button class="group-first:rounded-s group-last:rounded-e transition-colors hover:bg-[rgba(255,255,255,0.15)] bg-[rgba(255,255,255,0.07)] shadow-inner border border-[#606770] border-solid p-3 text-base font-bold text-[rgb(227,227,227)] leading-[26px] cursor-pointer hover:text-white border-l-0 group-first:border-l font-[inherit]">#     </button><div class="transition-[max-height,padding,opacity] rounded-b py-1 overflow-hidden border border-[#606770] border-solid border-t-0 z-10 absolute bg-[#1B1B1D] group-last:right-0 -left-px group-last:left-auto group-first:left-auto flex-col shadow-black shadow-lg min-w-[calc(100%+1px)]" style="padding:0px;opacity:0.5;border-bottom-width:0px;max-height:0px"></div></div><div class="relative group"><button class="group-first:rounded-s group-last:rounded-e transition-colors hover:bg-[rgba(255,255,255,0.15)] bg-[rgba(255,255,255,0.07)] shadow-inner border border-[#606770] border-solid p-3 text-base font-bold text-[rgb(227,227,227)] leading-[26px] cursor-pointer hover:text-white border-l-0 group-first:border-l font-[inherit]">Customer</button><div class="transition-[max-height,padding,opacity] rounded-b py-1 overflow-hidden border border-[#606770] border-solid border-t-0 z-10 absolute bg-[#1B1B1D] group-last:right-0 -left-px group-last:left-auto group-first:left-auto flex-col shadow-black shadow-lg min-w-[calc(100%+1px)]" style="padding:0px;opacity:0.5;border-bottom-width:0px;max-height:0px"></div></div><div class="relative group"><button class="group-first:rounded-s group-last:rounded-e transition-colors hover:bg-[rgba(255,255,255,0.15)] bg-[rgba(255,255,255,0.07)] shadow-inner border border-[#606770] border-solid p-3 text-base font-bold text-[rgb(227,227,227)] leading-[26px] cursor-pointer hover:text-white border-l-0 group-first:border-l font-[inherit]">Amount</button><div class="transition-[max-height,padding,opacity] rounded-b py-1 overflow-hidden border border-[#606770] border-solid border-t-0 z-10 absolute bg-[#1B1B1D] group-last:right-0 -left-px group-last:left-auto group-first:left-auto flex-col shadow-black shadow-lg min-w-[calc(100%+1px)]" style="padding:0px;opacity:0.5;border-bottom-width:0px;max-height:0px"></div></div></div><div class="flex items-start"><table class="mb-0"><thead><tr class="bg-[#1B1B1D]"><th>Date        </th><th>#     </th><th>Customer</th><th>Amount</th></tr></thead><tbody><tr class="even:bg-inherit"><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td></tr><tr class="even:bg-inherit"><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td></tr><tr class="even:bg-inherit"><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td></tr></tbody></table><div class="relative group"><button class="group-first:rounded-s group-last:rounded-e transition-colors hover:bg-[rgba(255,255,255,0.15)] bg-[rgba(255,255,255,0.07)] shadow-inner border border-[#606770] border-solid p-3 text-base font-bold text-[rgb(227,227,227)] leading-[26px] cursor-pointer hover:text-white border-l-0 group-first:border-l font-[inherit]"><span class="font-[Arial] text-2xl leading-[23px]">⚙</span></button><div class="transition-[max-height,padding,opacity] rounded-b py-1 overflow-hidden border border-[#606770] border-solid border-t-0 z-10 absolute bg-[#1B1B1D] group-last:right-0 -left-px group-last:left-auto group-first:left-auto flex-col shadow-black shadow-lg min-w-[calc(100%+1px)]" style="padding:0px;opacity:0.5;border-bottom-width:0px;max-height:0px"><label class="px-2 py-1 truncate block"><input type="checkbox" id="date" checked="" value="date">Date        </label><label class="px-2 py-1 truncate block"><input type="checkbox" id="id" checked="" value="id">#     </label><label class="px-2 py-1 truncate block"><input type="checkbox" id="customer" checked="" value="customer">Customer</label><label class="px-2 py-1 truncate block"><input type="checkbox" id="amount" checked="" value="amount">Amount</label><label class="px-2 py-1 truncate block"><input type="checkbox" id="currency" value="currency">Currency</label><label class="px-2 py-1 truncate block"><input type="checkbox" id="country" value="country">Country </label></div></div></div>
<div class="language-tsx codeBlockContainer_t37y theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#212432"><div class="codeBlockContent_evnz"><pre tabindex="0" class="prism-code language-tsx codeBlock_eucs thin-scrollbar" style="color:#9CDCFE;background-color:#212432"><code class="codeBlockLines_ir7E"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:rgb(220, 220, 170)">onAddColumnClick</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">attribute</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(212, 212, 212)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">addColumn</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">attribute</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">addFilter</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">attribute</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre><div class="buttonGroup_WgNt"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Grdj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_cxvn"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_I15G"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This works. Finally… Oops. You forgot to synchronize the remove column handler.
Fast forward. 2028. You are implementing reset columns to default. Oops. Forgot to reset filters as well.
Fast forward. 2029. Implementing column presets. Oops. Forgot to update filters as well.
Fast forward. 2030. Oops…</p>
<p>You got the idea. Every time new functionality updating columns is added, you must also remember to update the filters.
This is unmaintainable and error-prone.</p>
<ul class="list-none pl-2"><li><span class="bg-[rgba(0,255,0,0.15)] rounded-full font-bold text-[rgba(200,255,150,0.65)] text-center inline-block leading-4 pb-1 w-5 align-text-top">+</span> <!-- -->Simple</li></ul>
<ul class="list-none pl-2"><li><span class="bg-[rgba(255,50,0,0.2)] rounded-full font-black text-[rgba(255,170,150.8)] text-center inline-block leading-4 pb-1 w-5 align-text-top">-</span> <!-- -->Unmaintainable in a long run</li></ul>
<p> </p>
<h3 class="anchor anchorWithStickyNavbar_BFL_" id="2-gate-setter-approach">2. Gate Setter Approach<a href="#2-gate-setter-approach" class="hash-link" aria-label="Direct link to 2. Gate Setter Approach" title="Direct link to 2. Gate Setter Approach">​</a></h3>
<div class="language-tsx codeBlockContainer_t37y theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#212432"><div class="codeBlockContent_evnz"><pre tabindex="0" class="prism-code language-tsx codeBlock_eucs thin-scrollbar" style="color:#9CDCFE;background-color:#212432"><code class="codeBlockLines_ir7E"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">ColumnsProvider</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">columns</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> setColumnsInner</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">useState</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">initColumns</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> setFilters </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">useContext</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token maybe-class-name">FiltersContext</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:rgb(220, 220, 170)">setColumns</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">columns</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(212, 212, 212)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">setColumnsInner</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">columns</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">setFilters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">columns</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// use setColumns instead of setColumnsInner</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token spread operator" style="color:rgb(212, 212, 212)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre><div class="buttonGroup_WgNt"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Grdj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_cxvn"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_I15G"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>So naturally you centralized state update logic and moved the setter closer to the state, creating some kind of gate where all updates must come through.
In <code>ColumnsProvider</code>, you implemented a <code>setColumns</code> wrapper function.</p>
<p>It works… Oops. Now, when you add a new column, all filters are reset.
So you need to write some merge function which modifies only filters that changed.</p>
<div class="language-tsx codeBlockContainer_t37y theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#212432"><div class="codeBlockContent_evnz"><pre tabindex="0" class="prism-code language-tsx codeBlock_eucs thin-scrollbar" style="color:#9CDCFE;background-color:#212432"><code class="codeBlockLines_ir7E"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:rgb(220, 220, 170)">setColumns</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">columns</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(212, 212, 212)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">setColumnsInner</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">columns</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">setFilters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">prevFilters </span><span class="token arrow operator" style="color:rgb(212, 212, 212)">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">mergeFilters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">prevFilters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> columns</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre><div class="buttonGroup_WgNt"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Grdj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_cxvn"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_I15G"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>It is definitely a better approach, but if you’re like me, you feel it is still fragile in the long run.
After some years and several new colleagues, somebody will create code that calls <code>setColumnsInner</code> directly without your gate.</p>
<p>I also find it unexpected and confusing that <code>ColumnsProvider</code> depends on <code>FiltersContext</code>. I would expect it the other way around. But you can decide whether you share this perspective.</p>
<p>You might also end up with cyclic dependency because, if you remember the initialization logic above, you know <code>FiltersProvider</code> depends on <code>ColumnsContext</code>.
So we need to use constant for initializing filters instead, which creates a need to keep the initial value in sync too.</p>
<ul class="list-none pl-2"><li><span class="bg-[rgba(0,255,0,0.15)] rounded-full font-bold text-[rgba(200,255,150,0.65)] text-center inline-block leading-4 pb-1 w-5 align-text-top">+</span> <!-- -->Better maintainability</li></ul>
<ul class="list-none pl-2"><li><span class="bg-[rgba(255,50,0,0.2)] rounded-full font-black text-[rgba(255,170,150.8)] text-center inline-block leading-4 pb-1 w-5 align-text-top">-</span> <!-- -->Need for merging function</li><li><span class="bg-[rgba(255,50,0,0.2)] rounded-full font-black text-[rgba(255,170,150.8)] text-center inline-block leading-4 pb-1 w-5 align-text-top">-</span> <!-- -->Reverted dependency</li><li><span class="bg-[rgba(255,50,0,0.2)] rounded-full font-black text-[rgba(255,170,150.8)] text-center inline-block leading-4 pb-1 w-5 align-text-top">-</span> <!-- -->Cyclic dependency</li></ul>
<p>Is there a better option?</p>
<p> </p>
<h3 class="anchor anchorWithStickyNavbar_BFL_" id="3-effect-approach">3. Effect Approach<a href="#3-effect-approach" class="hash-link" aria-label="Direct link to 3. Effect Approach" title="Direct link to 3. Effect Approach">​</a></h3>
<!-- -->
<div class="flex mb-2 w-full flex-wrap"><div class="relative group"><button class="group-first:rounded-s group-last:rounded-e transition-colors hover:bg-[rgba(255,255,255,0.15)] bg-[rgba(255,255,255,0.07)] shadow-inner border border-[#606770] border-solid p-3 text-base font-bold text-[rgb(227,227,227)] leading-[26px] cursor-pointer hover:text-white border-l-0 group-first:border-l font-[inherit]">Date        </button><div class="transition-[max-height,padding,opacity] rounded-b py-1 overflow-hidden border border-[#606770] border-solid border-t-0 z-10 absolute bg-[#1B1B1D] group-last:right-0 -left-px group-last:left-auto group-first:left-auto flex-col shadow-black shadow-lg min-w-[calc(100%+1px)]" style="padding:0px;opacity:0.5;border-bottom-width:0px;max-height:0px"></div></div><div class="relative group"><button class="group-first:rounded-s group-last:rounded-e transition-colors hover:bg-[rgba(255,255,255,0.15)] bg-[rgba(255,255,255,0.07)] shadow-inner border border-[#606770] border-solid p-3 text-base font-bold text-[rgb(227,227,227)] leading-[26px] cursor-pointer hover:text-white border-l-0 group-first:border-l font-[inherit]">#     </button><div class="transition-[max-height,padding,opacity] rounded-b py-1 overflow-hidden border border-[#606770] border-solid border-t-0 z-10 absolute bg-[#1B1B1D] group-last:right-0 -left-px group-last:left-auto group-first:left-auto flex-col shadow-black shadow-lg min-w-[calc(100%+1px)]" style="padding:0px;opacity:0.5;border-bottom-width:0px;max-height:0px"></div></div><div class="relative group"><button class="group-first:rounded-s group-last:rounded-e transition-colors hover:bg-[rgba(255,255,255,0.15)] bg-[rgba(255,255,255,0.07)] shadow-inner border border-[#606770] border-solid p-3 text-base font-bold text-[rgb(227,227,227)] leading-[26px] cursor-pointer hover:text-white border-l-0 group-first:border-l font-[inherit]">Customer</button><div class="transition-[max-height,padding,opacity] rounded-b py-1 overflow-hidden border border-[#606770] border-solid border-t-0 z-10 absolute bg-[#1B1B1D] group-last:right-0 -left-px group-last:left-auto group-first:left-auto flex-col shadow-black shadow-lg min-w-[calc(100%+1px)]" style="padding:0px;opacity:0.5;border-bottom-width:0px;max-height:0px"></div></div><div class="relative group"><button class="group-first:rounded-s group-last:rounded-e transition-colors hover:bg-[rgba(255,255,255,0.15)] bg-[rgba(255,255,255,0.07)] shadow-inner border border-[#606770] border-solid p-3 text-base font-bold text-[rgb(227,227,227)] leading-[26px] cursor-pointer hover:text-white border-l-0 group-first:border-l font-[inherit]">Amount</button><div class="transition-[max-height,padding,opacity] rounded-b py-1 overflow-hidden border border-[#606770] border-solid border-t-0 z-10 absolute bg-[#1B1B1D] group-last:right-0 -left-px group-last:left-auto group-first:left-auto flex-col shadow-black shadow-lg min-w-[calc(100%+1px)]" style="padding:0px;opacity:0.5;border-bottom-width:0px;max-height:0px"></div></div></div><div class="flex items-start"><table class="mb-0"><thead><tr class="bg-[#1B1B1D]"><th>Date        </th><th>#     </th><th>Customer</th><th>Amount</th></tr></thead><tbody><tr class="even:bg-inherit"><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td></tr><tr class="even:bg-inherit"><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td></tr><tr class="even:bg-inherit"><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td></tr></tbody></table><div class="relative group"><button class="group-first:rounded-s group-last:rounded-e transition-colors hover:bg-[rgba(255,255,255,0.15)] bg-[rgba(255,255,255,0.07)] shadow-inner border border-[#606770] border-solid p-3 text-base font-bold text-[rgb(227,227,227)] leading-[26px] cursor-pointer hover:text-white border-l-0 group-first:border-l font-[inherit]"><span class="font-[Arial] text-2xl leading-[23px]">⚙</span></button><div class="transition-[max-height,padding,opacity] rounded-b py-1 overflow-hidden border border-[#606770] border-solid border-t-0 z-10 absolute bg-[#1B1B1D] group-last:right-0 -left-px group-last:left-auto group-first:left-auto flex-col shadow-black shadow-lg min-w-[calc(100%+1px)]" style="padding:0px;opacity:0.5;border-bottom-width:0px;max-height:0px"><label class="px-2 py-1 truncate block"><input type="checkbox" id="date" checked="" value="date">Date        </label><label class="px-2 py-1 truncate block"><input type="checkbox" id="id" checked="" value="id">#     </label><label class="px-2 py-1 truncate block"><input type="checkbox" id="customer" checked="" value="customer">Customer</label><label class="px-2 py-1 truncate block"><input type="checkbox" id="amount" checked="" value="amount">Amount</label><label class="px-2 py-1 truncate block"><input type="checkbox" id="currency" value="currency">Currency</label><label class="px-2 py-1 truncate block"><input type="checkbox" id="country" value="country">Country </label></div></div></div><div class="text-sm text-gray-400 mb-5">Number of requests: <!-- -->0</div>
<div class="language-tsx codeBlockContainer_t37y theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#212432"><div class="codeBlockContent_evnz"><pre tabindex="0" class="prism-code language-tsx codeBlock_eucs thin-scrollbar" style="color:#9CDCFE;background-color:#212432"><code class="codeBlockLines_ir7E"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">columns</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">useContext</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token maybe-class-name">ColumnsCtx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">setFilters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">useContext</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token maybe-class-name">FiltersCtx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">useEffect</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(212, 212, 212)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">setFilters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">prevFilters </span><span class="token arrow operator" style="color:rgb(212, 212, 212)">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">mergeFilters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">prevFilters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> columns</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre><div class="buttonGroup_WgNt"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Grdj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_cxvn"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_I15G"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You may think of <code>useEffect</code>. It can react to any change to columns state.
Oops. Again, we need to use the <code>mergeFilters</code> function to avoid resetting all filters.</p>
<p>But there is a bigger problem. <code>useEffect</code> is not synchronous, and it does not run in the same render cycle.
So when you add a new column, the filters are not updated immediately.
There is a brief timeframe where your filters are not in sync with columns.</p>
<p>It can be a source of bugs and glitches.
The UI jumps back and forth. It is visually disturbing and can break animations.</p>
<p>But more importantly, it causes a double refetch, leading to performance issues, unnecessary server load, and increased costs.
You can see it by yourself in the interactive example above. Try to change visible columns and watch fired requests counter.</p>
<ul class="list-none pl-2"><li><span class="bg-[rgba(0,255,0,0.15)] rounded-full font-bold text-[rgba(200,255,150,0.65)] text-center inline-block leading-4 pb-1 w-5 align-text-top">+</span> <!-- -->Good maintainability</li><li><span class="bg-[rgba(0,255,0,0.15)] rounded-full font-bold text-[rgba(200,255,150,0.65)] text-center inline-block leading-4 pb-1 w-5 align-text-top">+</span> <!-- -->No weird dependencies</li></ul>
<ul class="list-none pl-2"><li><span class="bg-[rgba(255,50,0,0.2)] rounded-full font-black text-[rgba(255,170,150.8)] text-center inline-block leading-4 pb-1 w-5 align-text-top">-</span> <!-- -->Asynchronous update</li><li><span class="bg-[rgba(255,50,0,0.2)] rounded-full font-black text-[rgba(255,170,150.8)] text-center inline-block leading-4 pb-1 w-5 align-text-top">-</span> <!-- -->UI glitches</li><li><span class="bg-[rgba(255,50,0,0.2)] rounded-full font-black text-[rgba(255,170,150.8)] text-center inline-block leading-4 pb-1 w-5 align-text-top">-</span> <!-- -->Doubled fetching</li><li><span class="bg-[rgba(255,50,0,0.2)] rounded-full font-black text-[rgba(255,170,150.8)] text-center inline-block leading-4 pb-1 w-5 align-text-top">-</span> <!-- -->Need for merging function</li></ul>
<p>Do not use <code>useEffect</code> for synchronizing states.</p>
<p> </p>
<h3 class="anchor anchorWithStickyNavbar_BFL_" id="4-selector-approach">4. Selector Approach<a href="#4-selector-approach" class="hash-link" aria-label="Direct link to 4. Selector Approach" title="Direct link to 4. Selector Approach">​</a></h3>
<!-- -->
<div class="flex mb-2 w-full flex-wrap"><div class="relative group"><button class="group-first:rounded-s group-last:rounded-e transition-colors hover:bg-[rgba(255,255,255,0.15)] bg-[rgba(255,255,255,0.07)] shadow-inner border border-[#606770] border-solid p-3 text-base font-bold text-[rgb(227,227,227)] leading-[26px] cursor-pointer hover:text-white border-l-0 group-first:border-l font-[inherit]">Date        </button><div class="transition-[max-height,padding,opacity] rounded-b py-1 overflow-hidden border border-[#606770] border-solid border-t-0 z-10 absolute bg-[#1B1B1D] group-last:right-0 -left-px group-last:left-auto group-first:left-auto flex-col shadow-black shadow-lg min-w-[calc(100%+1px)]" style="padding:0px;opacity:0.5;border-bottom-width:0px;max-height:0px"></div></div><div class="relative group"><button class="group-first:rounded-s group-last:rounded-e transition-colors hover:bg-[rgba(255,255,255,0.15)] bg-[rgba(255,255,255,0.07)] shadow-inner border border-[#606770] border-solid p-3 text-base font-bold text-[rgb(227,227,227)] leading-[26px] cursor-pointer hover:text-white border-l-0 group-first:border-l font-[inherit]">#     </button><div class="transition-[max-height,padding,opacity] rounded-b py-1 overflow-hidden border border-[#606770] border-solid border-t-0 z-10 absolute bg-[#1B1B1D] group-last:right-0 -left-px group-last:left-auto group-first:left-auto flex-col shadow-black shadow-lg min-w-[calc(100%+1px)]" style="padding:0px;opacity:0.5;border-bottom-width:0px;max-height:0px"></div></div><div class="relative group"><button class="group-first:rounded-s group-last:rounded-e transition-colors hover:bg-[rgba(255,255,255,0.15)] bg-[rgba(255,255,255,0.07)] shadow-inner border border-[#606770] border-solid p-3 text-base font-bold text-[rgb(227,227,227)] leading-[26px] cursor-pointer hover:text-white border-l-0 group-first:border-l font-[inherit]">Customer</button><div class="transition-[max-height,padding,opacity] rounded-b py-1 overflow-hidden border border-[#606770] border-solid border-t-0 z-10 absolute bg-[#1B1B1D] group-last:right-0 -left-px group-last:left-auto group-first:left-auto flex-col shadow-black shadow-lg min-w-[calc(100%+1px)]" style="padding:0px;opacity:0.5;border-bottom-width:0px;max-height:0px"></div></div><div class="relative group"><button class="group-first:rounded-s group-last:rounded-e transition-colors hover:bg-[rgba(255,255,255,0.15)] bg-[rgba(255,255,255,0.07)] shadow-inner border border-[#606770] border-solid p-3 text-base font-bold text-[rgb(227,227,227)] leading-[26px] cursor-pointer hover:text-white border-l-0 group-first:border-l font-[inherit]">Amount</button><div class="transition-[max-height,padding,opacity] rounded-b py-1 overflow-hidden border border-[#606770] border-solid border-t-0 z-10 absolute bg-[#1B1B1D] group-last:right-0 -left-px group-last:left-auto group-first:left-auto flex-col shadow-black shadow-lg min-w-[calc(100%+1px)]" style="padding:0px;opacity:0.5;border-bottom-width:0px;max-height:0px"></div></div></div><div class="flex items-start"><table class="mb-0"><thead><tr class="bg-[#1B1B1D]"><th>Date        </th><th>#     </th><th>Customer</th><th>Amount</th></tr></thead><tbody><tr class="even:bg-inherit"><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td></tr><tr class="even:bg-inherit"><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td></tr><tr class="even:bg-inherit"><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td><td class="overflow-hidden"><span class="opacity-15 max-w-0 inline-block whitespace-nowrap">● ● ●</span></td></tr></tbody></table><div class="relative group"><button class="group-first:rounded-s group-last:rounded-e transition-colors hover:bg-[rgba(255,255,255,0.15)] bg-[rgba(255,255,255,0.07)] shadow-inner border border-[#606770] border-solid p-3 text-base font-bold text-[rgb(227,227,227)] leading-[26px] cursor-pointer hover:text-white border-l-0 group-first:border-l font-[inherit]"><span class="font-[Arial] text-2xl leading-[23px]">⚙</span></button><div class="transition-[max-height,padding,opacity] rounded-b py-1 overflow-hidden border border-[#606770] border-solid border-t-0 z-10 absolute bg-[#1B1B1D] group-last:right-0 -left-px group-last:left-auto group-first:left-auto flex-col shadow-black shadow-lg min-w-[calc(100%+1px)]" style="padding:0px;opacity:0.5;border-bottom-width:0px;max-height:0px"><label class="px-2 py-1 truncate block"><input type="checkbox" id="date" checked="" value="date">Date        </label><label class="px-2 py-1 truncate block"><input type="checkbox" id="id" checked="" value="id">#     </label><label class="px-2 py-1 truncate block"><input type="checkbox" id="customer" checked="" value="customer">Customer</label><label class="px-2 py-1 truncate block"><input type="checkbox" id="amount" checked="" value="amount">Amount</label><label class="px-2 py-1 truncate block"><input type="checkbox" id="currency" value="currency">Currency</label><label class="px-2 py-1 truncate block"><input type="checkbox" id="country" value="country">Country </label></div></div></div><div class="text-sm text-gray-400 mb-5">Number of requests: <!-- -->0</div>
<div class="language-tsx codeBlockContainer_t37y theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#212432"><div class="codeBlockContent_evnz"><pre tabindex="0" class="prism-code language-tsx codeBlock_eucs thin-scrollbar" style="color:#9CDCFE;background-color:#212432"><code class="codeBlockLines_ir7E"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">useFilters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">attributes</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">useContext</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token maybe-class-name">AttributesCtx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">filters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">useContext</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token maybe-class-name">FiltersCtx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> attributes</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">map</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">attribute</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(212, 212, 212)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> filter </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> filters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">attribute</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"> attribute</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token spread operator" style="color:rgb(212, 212, 212)">...</span><span class="token plain">filter </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre><div class="buttonGroup_WgNt"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Grdj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_cxvn"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_I15G"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-tsx codeBlockContainer_t37y theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#212432"><div class="codeBlockContent_evnz"><pre tabindex="0" class="prism-code language-tsx codeBlock_eucs thin-scrollbar" style="color:#9CDCFE;background-color:#212432"><code class="codeBlockLines_ir7E"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">type</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">Filters</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">attribute</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">string</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        operator</span><span class="token operator" style="color:rgb(212, 212, 212)">?</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;=&#x27;</span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;&gt;&#x27;</span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;&lt;&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        value</span><span class="token operator" style="color:rgb(212, 212, 212)">?</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">string</span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token builtin" style="color:rgb(86, 156, 214)">number</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain">   </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre><div class="buttonGroup_WgNt"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Grdj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_cxvn"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_I15G"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>What you encountered is a problem with state synchronization caused by duplicate state.
Filters and columns are different entities, but part of their state is duplicated and can be shared.
It’s about visible attributes. So we extract the visible attributes from both states and derive visible columns and filters from them.
Let’s step into a time machine and go back to 2027, where we were shaping filters state.</p>
<p>We want to change the semantics of the filters state. It will not hold which filters are visible but just which attributes are filtered.
We adjust the shape of the filters and make it a dictionary.
The <code>useFilters</code> hook will merge two states: visible attributes and modified filters.
The benefit is that we do not have to initialize the state at all.
Since columns don’t contain any additional state beyond attributes, we can use attributes directly in the same manner as columns before (this is not always the case, but let’s keep this example simple).</p>
<p><img decoding="async" loading="lazy" alt="State Synchronization Selector Approach Diagram" src="/assets/images/avoid-state-sync-trap-diagram-41eb1aaa06484971c6980e9471db0f0b.png" width="1556" height="713" class="img_jf__"></p>
<p>This way, filters will always be the same as columns.
Even if the filters state is empty, there is no need for initialization.
The change is synchronous. No glitches. No useless refetches.
Columns are independent of Filters.
The column state can be updated in any way, and the reactivity system will take care of rerunning this derivation logic.</p>
<p>You might argue someone can forget to use this hook and access the filters state directly.
You are right.
So what’s the advantage compared to the <code>setColumns</code> wrapper function?
But <abbr title="In My Opinion">IMO</abbr>, it’s less likely to happen since forgetting the hook would immediately result in an empty state.</p>
<p>Also, this derivation logic (selector) is easier to maintain than a setter (action) because it is reactive.
We just focus on control logic, not when it should be called.
The reactive system takes care of it.</p>
<p>It is fair to say that there is a hidden user experience difference.
When the attribute is filtered, then removed and added again, it holds the previous filter values.
Therefore, orders are filtered after the column is added back.
You can try it by yourself in the interactive example above.</p>
<p>Sometimes this behavior is even desired, but in this situation it is unintuitive, and I see it as a disadvantage here.
It is fixable by combining this selector approach with the previously mentioned gate setter approach.
Simply clear the selected filter whenever a column is removed.
However, I’ll keep this article short and won’t go into further detail here.
I see this as an edge-case, and I believe mentioned benefits outweigh this disadvantage.
But feel free to make your own opinion here.</p>
<ul class="list-none pl-2"><li><span class="bg-[rgba(0,255,0,0.15)] rounded-full font-bold text-[rgba(200,255,150,0.65)] text-center inline-block leading-4 pb-1 w-5 align-text-top">+</span> <!-- -->Good maintainability</li><li><span class="bg-[rgba(0,255,0,0.15)] rounded-full font-bold text-[rgba(200,255,150,0.65)] text-center inline-block leading-4 pb-1 w-5 align-text-top">+</span> <!-- -->No weird dependencies</li><li><span class="bg-[rgba(0,255,0,0.15)] rounded-full font-bold text-[rgba(200,255,150,0.65)] text-center inline-block leading-4 pb-1 w-5 align-text-top">+</span> <!-- -->Synchronous update</li><li><span class="bg-[rgba(0,255,0,0.15)] rounded-full font-bold text-[rgba(200,255,150,0.65)] text-center inline-block leading-4 pb-1 w-5 align-text-top">+</span> <!-- -->No UI glitches</li><li><span class="bg-[rgba(0,255,0,0.15)] rounded-full font-bold text-[rgba(200,255,150,0.65)] text-center inline-block leading-4 pb-1 w-5 align-text-top">+</span> <!-- -->Single fetch</li></ul>
<ul class="list-none pl-2"><li><span class="bg-[rgba(255,50,0,0.2)] rounded-full font-black text-[rgba(255,170,150.8)] text-center inline-block leading-4 pb-1 w-5 align-text-top">-</span> <!-- -->Overly persistent state</li></ul>
<p> </p>
<h2 class="anchor anchorWithStickyNavbar_BFL_" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2>
<p>In 2027, we made a quite dangerous assumption: that columns and filters must be in sync.
It is an invariant of your state shape, which TypeScript is not able to check. Therefore, you need to handle it manually.
This was just one example inspired by a real-world problem. But I frequently see developers using effects and setters to synchronize states.
Selectors generally provide more maintainable solutions, are synchronous, and ensure immediate, predictable updates.</p>
<p><abbr title="In My Opinion">IMO</abbr>, these state invariants represent a bad code smell.
They frequently cause bugs, glitches, and performance issues.
Try to develop a nose for these invariants and pay attention when someone introduces one into your app.</p>
<p>I know the world out there is wild. Perhaps your junior colleague has already created a shape like this,
and it’s deeply baked into your app, leaving no time to refactor the entire codebase.
In such a case, I would recommend going with the gate setter solution.
Definitely avoid <code>useEffect</code> if possible.
Additionally, consider implementing a function that checks invariants that must always hold true for your state.
You can run this function within your derivation logic (selectors) to alert you immediately if an invariant breaks.</p>
<p>I hope I’ve given you some material to think about. As always, if you disagree with me, I encourage you to get in touch. In any case…</p>
<p>Thanks for reading.</p>
<!-- -->
<div class="flex gap-2 w-full flex-wrap my-8"><a href="https://x.com/ondrejvelisek/status/1911856456489681207" class="hover:no-underline px-4 py-3 border-solid border rounded border-zinc-700 text-white">Discuss on <svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="x-twitter" class="svg-inline--fa fa-x-twitter" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"></path></svg></a><a href="https://bsky.app/profile/ondrejvelisek.bsky.social/post/3lmsaw4qky22u" class="hover:no-underline px-4 py-3 border-solid border rounded border-zinc-700 text-white">Discuss on <svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="bluesky" class="svg-inline--fa fa-bluesky" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M111.8 62.2C170.2 105.9 233 194.7 256 242.4c23-47.6 85.8-136.4 144.2-180.2c42.1-31.6 110.3-56 110.3 21.8c0 15.5-8.9 130.5-14.1 149.2C478.2 298 412 314.6 353.1 304.5c102.9 17.5 129.1 75.5 72.5 133.5c-107.4 110.2-154.3-27.6-166.3-62.9l0 0c-1.7-4.9-2.6-7.8-3.3-7.8s-1.6 3-3.3 7.8l0 0c-12 35.3-59 173.1-166.3 62.9c-56.5-58-30.4-116 72.5-133.5C100 314.6 33.8 298 15.7 233.1C10.4 214.4 1.5 99.4 1.5 83.9c0-77.8 68.2-53.4 110.3-21.8z"></path></svg></a><a href="https://www.linkedin.com/posts/ondrej-velisek_avoid-the-state-synchronization-trap-ondrej-activity-7317623391673307137-Pl4z/" class="hover:no-underline px-4 py-3 border-solid border rounded border-zinc-700 text-white">Discuss on <svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="linkedin" class="svg-inline--fa fa-linkedin" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></a></div>
<p> </p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/tanstack-start-new-competitor-to-nextjs/"><div class="pagination-nav__sublabel">Newer post</div><div class="pagination-nav__label">TanStack Start: New competitor to Next.js</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/how-nextjs-breaks-react-fundamentals/"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">How Next.js breaks React Fundamentals (Examples)</div></a></nav></main><div class="col col--2"><div class="tableOfContents_XeQp thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#example" class="table-of-contents__link toc-highlight">Example</a><ul><li><a href="#2025-list-of-orders" class="table-of-contents__link toc-highlight">2025: List of Orders</a></li><li><a href="#2026-custom-columns" class="table-of-contents__link toc-highlight">2026: Custom Columns</a></li><li><a href="#2027-filters" class="table-of-contents__link toc-highlight">2027: Filters</a></li></ul></li><li><a href="#state-initialization" class="table-of-contents__link toc-highlight">State Initialization</a></li><li><a href="#state-synchronization" class="table-of-contents__link toc-highlight">State Synchronization</a><ul><li><a href="#1-direct-setters-approach" class="table-of-contents__link toc-highlight">1. Direct Setters Approach</a></li><li><a href="#2-gate-setter-approach" class="table-of-contents__link toc-highlight">2. Gate Setter Approach</a></li><li><a href="#3-effect-approach" class="table-of-contents__link toc-highlight">3. Effect Approach</a></li><li><a href="#4-selector-approach" class="table-of-contents__link toc-highlight">4. Selector Approach</a></li></ul></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright"><div class="flex justify-between">
        <div>Copyright © 2025 Ondrej Velisek</div>
        <div>Made with ❤️ in Czech republic.</div>
      </div></div></div></div></footer></div>
</body>
</html>