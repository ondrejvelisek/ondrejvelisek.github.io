<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">Conceptual Model of React and RSC | Ondrej Velisek</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://ondrejvelisek.github.io/2024/03/03/conceptual-model-of-react-and-rsc/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Conceptual Model of React and RSC | Ondrej Velisek"><meta data-rh="true" name="description" content="Building web apps is a complex problem. We need simple high-level mental structures to support such a heavy load."><meta data-rh="true" property="og:description" content="Building web apps is a complex problem. We need simple high-level mental structures to support such a heavy load."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2024-03-03T00:00:00.000Z"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://ondrejvelisek.github.io/2024/03/03/conceptual-model-of-react-and-rsc/"><link data-rh="true" rel="alternate" href="https://ondrejvelisek.github.io/2024/03/03/conceptual-model-of-react-and-rsc/" hreflang="en"><link data-rh="true" rel="alternate" href="https://ondrejvelisek.github.io/2024/03/03/conceptual-model-of-react-and-rsc/" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/rss.xml" title="Ondrej Velisek RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Ondrej Velisek Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-BZWT5GPVTE"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-BZWT5GPVTE",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.e873652a.css">
<script src="/assets/js/runtime~main.bda235fa.js" defer="defer"></script>
<script src="/assets/js/main.27b61ea9.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_G6ar" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbar--dark"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/ondrejvelisek-logo.svg" alt="ondrejvelisek Logo" class="themedComponent_DHUr themedComponent--light_DIHH"><img src="/img/ondrejvelisek-logo.svg" alt="ondrejvelisek Logo" class="themedComponent_DHUr themedComponent--dark_Bv2M"></div></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/ondrejvelisek/torrta" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_awgD"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbarSearchContainer_bmvg"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_UyTV"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_RYHo thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_sRjx margin-bottom--md">Recent posts</div><ul class="sidebarItemList_uMtB clean-list"><li class="sidebarItem_rygH"><a aria-current="page" class="sidebarItemLink_EKgd sidebarItemLinkActive_hRXJ" href="/2024/03/03/conceptual-model-of-react-and-rsc/">Conceptual Model of React and RSC</a></li><li class="sidebarItem_rygH"><a class="sidebarItemLink_EKgd" href="/2022/03/23/practical-limits-of-react-hooks-recursion/">Practical limits of React hooks - Recursion</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="https://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="Building web apps is a complex problem. We need simple high-level mental structures to support such a heavy load."><header><h1 class="title_cIQJ" itemprop="headline">Conceptual Model of React and RSC</h1><div class="container_PuMg margin-vert--md"><time datetime="2024-03-03T00:00:00.000Z" itemprop="datePublished">March 3, 2024</time> · <!-- -->9 min read</div></header><div id="__blog-post-container" class="markdown" itemprop="articleBody"><p>Building web apps is a complex problem. We need simple high-level mental structures to support such a heavy load.
These structures allow us to offload unnecessary details from our brains, so we can focus on the important parts of our code.
<code>UI = f(state)</code> is one of them. Every one of us knows this formula. But do you know what it reflects in the real world?
What is <code>UI</code>? What is <code>state</code>? What the f* is <em><code>f</code></em>? And how is it affected by RSC (React Server Components)? Here is my view.</p>
<p><img decoding="async" loading="lazy" alt="Holistic state philosophy" src="/assets/images/holistic-state-562930c5eec9df368ea3c02de81cc2b3.png" width="1791" height="820" class="img__Ss2"></p>
<p>First of all:</p>
<ul>
<li>I reckon the state mutates, but I ignore how it is mutated.</li>
<li>I show examples of React, but most of the following applies to other UI frameworks like Angular, Vue, Svelte, Qwik, or Solid.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_fF9Z" id="what-is-state">What is <code>state</code>?<a href="#what-is-state" class="hash-link" aria-label="Direct link to what-is-state" title="Direct link to what-is-state">​</a></h2>
<p>Let&#x27;s reconsider: <code>UI = f(state)</code>. In other words, <code>state</code> is what our <code>UI</code> depends on. If a dependency changes, we want to change the <code>UI</code>. This phenomenon is called <strong>reactivity</strong>.</p>
<p>I believe that state encompasses more than just in-memory local component state (<code>useState</code>) or in-memory global app state (Redux, Jotai, Zustand).
I&#x27;m not alone (
<a href="https://tkdodo.eu/blog/react-query-as-a-state-manager" target="_blank" rel="noopener noreferrer">TkDodo</a>,
<a href="https://www.youtube.com/watch?v=ukpgxEemXsk" target="_blank" rel="noopener noreferrer">ByteGrad (YouTube)</a>,
<a href="https://x.com/kentcdodds/status/1349173470567964673" target="_blank" rel="noopener noreferrer">Kent C. Dodds</a>,
<a href="https://daverupert.com/2024/02/ui-states/" target="_blank" rel="noopener noreferrer">Dave Rupert</a>,
<a href="https://overreacted.io/the-two-reacts/" target="_blank" rel="noopener noreferrer">Dan Abramov</a>
). Many developers agree that at least the URL and server data constitute some kind of state too. But I believe it has a much wider scope.</p>
<p>Let&#x27;s consider some <code>UI</code> examples:</p>
<ul>
<li>Blog post UI depends on the slug present in the <strong>URL</strong> address.</li>
<li>Server files explorer UI depends on <strong>server</strong> files.</li>
<li>The newest movies list UI relies on the <strong>third-party</strong> resource of OMDB.</li>
<li>Ticking clock UI depends on <strong>time</strong>.</li>
<li>Drawing canvas UI relies on the mouse position of the user&#x27;s <strong>input device</strong>.</li>
<li>User profile UI depends on the session token stored in a <strong>cookie</strong>.</li>
<li>The &quot;Keep me signed in on this device&quot; UI depends on a flag in <strong>local storage</strong>.</li>
<li>OS preferred dark mode UI depends on the <strong>OS setting</strong>.</li>
<li>Devtools debug UI depends on an <strong>env variable</strong>.</li>
<li>Panoramic background UI depends on the scroll position of a <strong>DOM</strong> element.</li>
<li>... Got the idea?</li>
</ul>
<p>I refer to these states as <strong>source states</strong>. It&#x27;s important to note that a state may be <em>derived</em>. For example:</p>
<ul>
<li>The current post <em>slug</em> depends on the <strong>URL</strong>.</li>
<li>The current post <em>minutes read</em> depends on the <em>slug</em> and <strong>server files</strong>.</li>
<li>The current <em>user role</em> depends on authorization data in the <strong>server database</strong> and the session token from the <strong>cookie</strong>.</li>
<li>The <em>preferred dark mode</em> depends on <strong>local storage</strong> and the <strong>OS setting</strong> (storage as user preference and OS as default).</li>
<li>The minutes value in a pausable stopwatch depends on <strong>time</strong> and the spacebar <strong>pressed key</strong>.</li>
<li>... Ok. You got it.</li>
</ul>
<p>Derived state depends on another state and should change when its dependencies change. In other words, it should be reactive. You can find a great deep-dive into this topic on <a href="https://reacttraining.com/blog/derived-state" target="_blank" rel="noopener noreferrer">React Training - Derived State</a>.</p>
<p>The boundary between <strong>source</strong> and <em>derived</em> states is blurry. For example, the server database, local storage, OS settings, all of those depend on file system data.
But let&#x27;s mark state as &quot;source&quot; when it depends solely on states inaccessible by available technologies. For example, I can&#x27;t access some private browser file with local storage data from the browser window environment.</p>
<p>I would like to be explicit and distinguish between in-memory state and all those kinds of states.
For myself, I name it a <strong>Holistic state</strong>.</p>
<h2 class="anchor anchorWithStickyNavbar_fF9Z" id="what-is-ui">What is <code>UI</code>?<a href="#what-is-ui" class="hash-link" aria-label="Direct link to what-is-ui" title="Direct link to what-is-ui">​</a></h2>
<p>It is what users perceive with their senses, usually with their eyes on the screen. On the web, it is represented with the <strong>DOM</strong>.</p>
<p>The wilderness out there is more diverse.
Our user might be a machine like a search indexing bot, but they also work on DOM elements and attributes.
There could be assistive technologies like a screen reader, working on the DOM as well.
A very important piece of UI is the URL in the browser address bar. Since it is always in sync with the URL state, I like to think about it as a source state rather than UI.
Users also perceive playing sounds, haptic vibration feedback, flashlight, etc.
Let&#x27;s simplify and stick with DOM only. It&#x27;s worth mentioning that the following applies to other UI pieces similarly.</p>
<p>As a developer, I expect the framework to provide tools to describe UI and update the DOM when the description changes.
In React and Vue, those tools are JSX and VDOM. In Solid, it is a signal dependency graph.</p>
<p>Note: I classified DOM as both UI and source state. If we use DOM as a source state and let our UI depend on it, we create a cyclic dependency.
Sometimes it is necessary, e.g., when measuring text width. Be careful in such situations to not create infinite loops. The same applies to the URL.</p>
<h2 class="anchor anchorWithStickyNavbar_fF9Z" id="what-the-f-is-f">What the f* is <em><code>f</code></em>?<a href="#what-the-f-is-f" class="hash-link" aria-label="Direct link to what-the-f-is-f" title="Direct link to what-the-f-is-f">​</a></h2>
<p><em><code>f</code></em> is something that connects <code>state</code> and <code>UI</code>.
You may say it is the component tree with its render function. And you are <abbr title="In My Opinion">IMO</abbr> partially right.</p>
<p>Because this <em><code>f</code></em> function usually produces many UI pieces,
it is a &quot;necessity&quot; to split the mental load into reusable smaller <code>f</code>s - components.
<a href="https://overreacted.io/a-chain-reaction/" target="_blank" rel="noopener noreferrer">Dan Abramov</a> wrote a great article about it.</p>
<p>React component ergonomics example:</p>
<div class="language-tsx codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_qZBB"><pre tabindex="0" class="prism-code language-tsx codeBlock_TAPP thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">Post</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">slug</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">                  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// name and state received via props</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> posts </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">useQuery</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">fetchPosts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// state received via hook</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> post </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> posts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">slug</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">           </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// derivation logic</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">post</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">           </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// JSX UI description</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup_TNwR"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_MVhB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_yxgH"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_QJLJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><strong>Name</strong> of the function to be referenceable.</li>
<li><strong>Receive state</strong> via props or hooks (or higher-order components).</li>
<li><strong>Derive state</strong> before JSX is produced. Right within the render function or separated into a custom function.</li>
<li><strong>Produce UI description</strong> in the form of JSX which is then consumed by VDOM.</li>
</ul>
<p>I said partially. Components do not (usually) directly connect to states. They just receive a value/connection.</p>
<h2 class="anchor anchorWithStickyNavbar_fF9Z" id="connecting-states">Connecting States<a href="#connecting-states" class="hash-link" aria-label="Direct link to Connecting States" title="Direct link to Connecting States">​</a></h2>
<p>We need a way to choose the states upon which our component depends. We want to subscribe/observe changes and execute derivation and rendering logic with new values.</p>
<p>Hooks do an excellent job with their smart <code>useEffect</code> and <code>useRef</code>. Much maligned for their ergonomics, but in my opinion, they get the conceptual job right. Let&#x27;s refer to custom hooks using <code>useEffect</code> and <code>useRef</code> as <strong>connecting hooks</strong>.</p>
<p>React connecting hook ergonomics example:</p>
<div class="language-tsx codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_qZBB"><pre tabindex="0" class="prism-code language-tsx codeBlock_TAPP thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// name and config received via props</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">fucntion </span><span class="token function" style="color:rgb(130, 170, 255)">useStopwatch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">delay</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">          </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">ticks</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> setTicks</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">useState</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">useEffect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">         </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// subscribing to real world state (time)            </span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> timer </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">setInterval</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">setTicks</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">prev </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> prev </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> delay</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">clearInterval</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">timer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">delay</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Returning reactive state</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> ticks                          </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup_TNwR"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_MVhB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_yxgH"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_QJLJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Many libraries like <code>tanstack-query</code> for external resources, <code>react-router</code> for URLs, or <code>react-use</code> for various kinds of states have been created. They allow us (app devs) to connect to the source state with just one line of code from within the component. And don&#x27;t care much about how. Great abstraction.</p>
<p>These connecting hooks are the missing glue between state and component rendering logic. They subscribe to state changes and rerun the necessary derivation and rendering logic accordingly.</p>
<p>In my opinion, the observer pattern is best for developer experience (DX). But sometimes it is not possible or desired, usually for performance reasons. Typically, this is the case for states far away from the client, like server data. Even for them, we have mechanisms like websockets or long polling. But usually, we fall back to the initial fetch during either component mount, server request, or build. Then caching, invalidation, and optimistic update mechanisms must come into play. But let&#x27;s still call them connecting hooks anyway.</p>
<p>There are hooks that create state themselves, like <code>useState</code> and <code>useReducer</code>, and simultaneously connect to it. But let&#x27;s stick with the word &quot;connecting&quot; only.</p>
<h2 class="anchor anchorWithStickyNavbar_fF9Z" id="developer-experience">Developer Experience<a href="#developer-experience" class="hash-link" aria-label="Direct link to Developer Experience" title="Direct link to Developer Experience">​</a></h2>
<p>So the real-world picture of <code>UI = f(state)</code> for app developers could be condensed into:</p>
<div class="language-js codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_qZBB"><pre tabindex="0" class="prism-code language-js codeBlock_TAPP thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#bfc7d5"><span class="token constant" style="color:rgb(130, 170, 255)">DOM</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">render</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">derive</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">connect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">holistic_state</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup_TNwR"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_MVhB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_yxgH"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_QJLJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>It is a super simple mental model for such a complex problem as a web app. It is <strong>conceptually clean and mentally relieving</strong>. Modern client-side <abbr title="Single Page Application">SPA</abbr>s follow this conceptual model quite precisely. I believe many devs love React 16.8+ (hooks introduced) because of this mental model, myself included. It speeds up development, saves time, and money.</p>
<p>But for the model to be helpful, some additional properties must be met:</p>
<ol>
<li>
<p><strong>Composable</strong> - Ability to compose components into the full UI.<br>
Ability to <mark>place any component into any other component</mark>.</p>
</li>
<li>
<p><strong>Reusable</strong> - Ability to define a name and reuse a component in a different place.<br>
Also, the ability to pass arbitrary configuration (possibly reactive state) to adjust its behavior (props).</p>
</li>
<li>
<p><strong>Colocated</strong> - Name, render logic, necessary state connections, state derivation logic, documentation, etc.<br>
Devs should be able to <mark>place all those dependencies inside a component</mark>.<br>
If not, devs jump back and forth in a codebase. Inconvenient.</p>
</li>
<li>
<p><strong>Encapsulated</strong> - Ability to work on a component independently by default. Opt-in to break the barrier.<br>
If not met, devs must mentally think about other code pieces.
Note: this is broken by React cascading memoization. Frustrating.</p>
</li>
<li>
<p><strong>Reactive</strong> - Component must react to connected state the dev chooses.<br>
<mark>Any component must be able to connect to any state</mark>. The same applies for derivation hooks.<br>
If some rules are required, it makes development jammed.</p>
</li>
<li>
<p><strong>Arbitrary</strong> - The component&#x27;s boundaries must obey the dev&#x27;s needs.<br>
<mark>Nothing must force a component to split (or not to split)</mark>.<br>
Same for derivation hooks. It destroys their purpose otherwise.</p>
</li>
</ol>
<p>Why does all of this matter? Because the conceptual model needs to be solid. All the time. If we develop some complex logic with those principles in mind, it can&#x27;t happen due to broken principles that we need to refactor. I want to trust it will support me during heavy loads.</p>
<p>I can handle some configuration and syntax overhead like useEffect, CSS integration, or Webpack. I&#x27;m fine to write a few extra chars if the conceptual model stays clear.</p>
<p>Client <abbr title="Single Page Application">SPA</abbr>s also suffer from bad performance. I believe that the conceptual model is so important; it should not be broken by enforcing good performance patterns. The framework should remain loyal to the clear model and do its best for performance. In addition, provide tools to optimize like optimization hints, refactoring patterns, or more aggressive caching config.</p>
<p>It seems to me <abbr title="React Server Components">RSC</abbr> and NextJS just <mark>break some fundamental properties of this conceptual model</mark> because of their performance-first design. And I believe it is not necessary to achieve their goals. But let&#x27;s stop here and keep this for the next article.</p>
<p>Thanks for reading.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--next" href="/2022/03/23/practical-limits-of-react-hooks-recursion/"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Practical limits of React hooks - Recursion</div></a></nav></main><div class="col col--2"><div class="tableOfContents_TN1Q thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#what-is-state" class="table-of-contents__link toc-highlight">What is <code>state</code>?</a></li><li><a href="#what-is-ui" class="table-of-contents__link toc-highlight">What is <code>UI</code>?</a></li><li><a href="#what-the-f-is-f" class="table-of-contents__link toc-highlight">What the f* is <em><code>f</code></em>?</a></li><li><a href="#connecting-states" class="table-of-contents__link toc-highlight">Connecting States</a></li><li><a href="#developer-experience" class="table-of-contents__link toc-highlight">Developer Experience</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright"><div class="flex justify-between">
        <div>Copyright © 2024 Ondrej Velisek</div>
        <div>Made with ❤️ in Czech republic.</div>
      </div></div></div></div></footer></div>
</body>
</html>