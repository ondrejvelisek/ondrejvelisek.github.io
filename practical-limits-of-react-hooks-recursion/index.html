<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Practical limits of React hooks - Recursion | Ondrej Velisek</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://ondrejvelisek.github.io/practical-limits-of-react-hooks-recursion/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Practical limits of React hooks - Recursion | Ondrej Velisek"><meta data-rh="true" name="description" content="While ago, I started using React hooks. The simplicity, homogenity and composability sounded great."><meta data-rh="true" property="og:description" content="While ago, I started using React hooks. The simplicity, homogenity and composability sounded great."><meta data-rh="true" property="og:image" content="https://ondrejvelisek.github.io/assets/images/hook-54996576765c9b42ad403e3eff720109.png"><meta data-rh="true" name="twitter:image" content="https://ondrejvelisek.github.io/assets/images/hook-54996576765c9b42ad403e3eff720109.png"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2022-03-23T00:00:00.000Z"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://ondrejvelisek.github.io/practical-limits-of-react-hooks-recursion/"><link data-rh="true" rel="alternate" href="https://ondrejvelisek.github.io/practical-limits-of-react-hooks-recursion/" hreflang="en"><link data-rh="true" rel="alternate" href="https://ondrejvelisek.github.io/practical-limits-of-react-hooks-recursion/" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://ondrejvelisek.github.io/practical-limits-of-react-hooks-recursion","mainEntityOfPage":"https://ondrejvelisek.github.io/practical-limits-of-react-hooks-recursion","url":"https://ondrejvelisek.github.io/practical-limits-of-react-hooks-recursion","headline":"Practical limits of React hooks - Recursion","name":"Practical limits of React hooks - Recursion","description":"While ago, I started using React hooks. The simplicity, homogenity and composability sounded great.","datePublished":"2022-03-23T00:00:00.000Z","author":[],"image":{"@type":"ImageObject","@id":"https://ondrejvelisek.github.io/assets/images/hook-54996576765c9b42ad403e3eff720109.png","url":"https://ondrejvelisek.github.io/assets/images/hook-54996576765c9b42ad403e3eff720109.png","contentUrl":"https://ondrejvelisek.github.io/assets/images/hook-54996576765c9b42ad403e3eff720109.png","caption":"title image for the blog post: Practical limits of React hooks - Recursion"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://ondrejvelisek.github.io/","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/rss.xml" title="Ondrej Velisek RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Ondrej Velisek Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-BZWT5GPVTE"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-BZWT5GPVTE",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.41670f90.css">
<script src="/assets/js/runtime~main.f5bada20.js" defer="defer"></script>
<script src="/assets/js/main.05c474a9.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/ondrejvelisek-logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_vI9N" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbar--dark"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/ondrejvelisek-logo.svg" alt="ondrejvelisek Logo" class="themedComponent_x2kJ themedComponent--light_yLPm"><img src="/img/ondrejvelisek-logo.svg" alt="ondrejvelisek Logo" class="themedComponent_x2kJ themedComponent--dark_ndWy"></div></a></div><div class="navbar__items navbar__items--right"><div class="navbarSearchContainer_DudH"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_MWqU"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_DpSO thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_yzVa margin-bottom--md">All posts</div><div role="group"><h3 class="yearGroupHeading_uu0Z">2024</h3><ul class="sidebarItemList_Rq9m clean-list"><li class="sidebarItem_tvmX"><a class="sidebarItemLink_DPHx" href="/how-nextjs-breaks-react-fundamentals/">How Next.js breaks React Fundamentals (Examples)</a></li><li class="sidebarItem_tvmX"><a class="sidebarItemLink_DPHx" href="/conceptual-model-of-react-and-rsc/">Conceptual Model of React and RSC</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_uu0Z">2022</h3><ul class="sidebarItemList_Rq9m clean-list"><li class="sidebarItem_tvmX"><a aria-current="page" class="sidebarItemLink_DPHx sidebarItemLinkActive_B_1E" href="/practical-limits-of-react-hooks-recursion/">Practical limits of React hooks - Recursion</a></li></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class="title_PojJ">Practical limits of React hooks - Recursion</h1><div class="container_Huic margin-vert--md"><time datetime="2022-03-23T00:00:00.000Z">March 23, 2022</time> · <!-- -->4 min read</div></header><div id="__blog-post-container" class="markdown"><p>While ago, I started using React hooks. The simplicity, homogenity and composability sounded great.
Both components and hooks are simple functions. I can easily react on state changes from memory,
local storage, location URL and server the same way - with hooks. Mental model stays simple.
My app is just a big function which consumes state and produces DOM. This big function is composed
of a smaller functions which are composed of smaller functions and so on. But there were obstacles
I&#x27;ve started to encounter and in the end I hit the hard limit of React hooks.</p>
<!-- -->
<blockquote>
<p>UPDATE 2024: new React <a href="https://react.dev/reference/react/use" target="_blank" rel="noopener noreferrer"><code>use</code></a> hook may finally solve following limitation
(if you accept <code>&lt;Suspense/&gt;</code> as a good pattern)</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_BFL_" id="model-app">Model app<a href="#model-app" class="hash-link" aria-label="Direct link to Model app" title="Direct link to Model app">​</a></h2>
<p>Each app has some data model defined with entities and relations between them. Lets say we have company
Department and Employee where department consists of other departments and/or direct employees.
One employee can directly work for exactly one department. Cycles in department hierarchy are prohibited.</p>
<p>Our Backend implements REST endpoints.</p>
<div class="language-code codeBlockContainer_t37y theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#212432"><div class="codeBlockTitle_bP0a">/departments</div><div class="codeBlockContent_evnz"><pre tabindex="0" class="prism-code language-code codeBlock_eucs thin-scrollbar" style="color:#9CDCFE;background-color:#212432"><code class="codeBlockLines_ir7E"><span class="token-line" style="color:#9CDCFE"><span class="token plain">returns list of all department ids</span><br></span></code></pre><div class="buttonGroup_WgNt"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Grdj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_cxvn"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_I15G"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-code codeBlockContainer_t37y theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#212432"><div class="codeBlockTitle_bP0a">/departments/:departmentId</div><div class="codeBlockContent_evnz"><pre tabindex="0" class="prism-code language-code codeBlock_eucs thin-scrollbar" style="color:#9CDCFE;background-color:#212432"><code class="codeBlockLines_ir7E"><span class="token-line" style="color:#9CDCFE"><span class="token plain">returns list of sub-department ids</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">and list of direct employee ids</span><br></span></code></pre><div class="buttonGroup_WgNt"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Grdj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_cxvn"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_I15G"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>There are three product requirements.</p>
<h2 class="anchor anchorWithStickyNavbar_BFL_" id="pleasant-walk-with-basic-hooks">Pleasant walk with basic hooks<a href="#pleasant-walk-with-basic-hooks" class="hash-link" aria-label="Direct link to Pleasant walk with basic hooks" title="Direct link to Pleasant walk with basic hooks">​</a></h2>
<p>First product requirement is simple. User selects a department and wants to see number of direct employees.
Pfff, its simple. Just implement this custom hook which uses department REST endpoint and use it in a component.</p>
<div class="language-tsx codeBlockContainer_t37y theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#212432"><div class="codeBlockContent_evnz"><pre tabindex="0" class="prism-code language-tsx codeBlock_eucs thin-scrollbar" style="color:#9CDCFE;background-color:#212432"><code class="codeBlockLines_ir7E"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">useDirectEmployeeCount</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    departmentId</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">number</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(212, 212, 212)">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">useDirectEmployeeIds</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">departmentId</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">length</span><br></span></code></pre><div class="buttonGroup_WgNt"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Grdj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_cxvn"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_I15G"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-tsx codeBlockContainer_t37y theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#212432"><div class="codeBlockContent_evnz"><pre tabindex="0" class="prism-code language-tsx codeBlock_eucs thin-scrollbar" style="color:#9CDCFE;background-color:#212432"><code class="codeBlockLines_ir7E"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">useDirectEmployeeIds</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    departmentId</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:rgb(78, 201, 176)">Array</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token builtin" style="color:rgb(86, 156, 214)">string</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(212, 212, 212)">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">useDepartment</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">departmentId</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">directEmployeeIds</span><br></span></code></pre><div class="buttonGroup_WgNt"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Grdj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_cxvn"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_I15G"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-tsx codeBlockContainer_t37y theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#212432"><div class="codeBlockContent_evnz"><pre tabindex="0" class="prism-code language-tsx codeBlock_eucs thin-scrollbar" style="color:#9CDCFE;background-color:#212432"><code class="codeBlockLines_ir7E"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">useDepartment</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    departmentId</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token maybe-class-name">Department</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(212, 212, 212)">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">useQuery</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;departments&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> departmentId</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(212, 212, 212)">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">fetch</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token template-string template-punctuation string" style="color:rgb(206, 145, 120)">`</span><span class="token template-string string" style="color:rgb(206, 145, 120)">/departments/</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">${</span><span class="token template-string interpolation">departmentId</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token template-string template-punctuation string" style="color:rgb(206, 145, 120)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">data</span><br></span></code></pre><div class="buttonGroup_WgNt"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Grdj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_cxvn"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_I15G"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Our backend implements exactly this endpoints so we use <code>react-query</code> and we are done.
There are some loading and error states which I omitted, we can use fancy Suspend and ErrorBoundary,
but we understand the code.</p>
<h2 class="anchor anchorWithStickyNavbar_BFL_" id="obstacles-with-looping">Obstacles with looping<a href="#obstacles-with-looping" class="hash-link" aria-label="Direct link to Obstacles with looping" title="Direct link to Obstacles with looping">​</a></h2>
<p>Second product requirement is simple. User needs to select multiple departments and see sum of direct employees.
Ok, simple. I already have code for one. So simply loop it over multiple selected departments and sum the result.</p>
<div class="language-tsx codeBlockContainer_t37y theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#212432"><div class="codeBlockContent_evnz"><pre tabindex="0" class="prism-code language-tsx codeBlock_eucs thin-scrollbar" style="color:#9CDCFE;background-color:#212432"><code class="codeBlockLines_ir7E"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> totalCount </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">sum</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    departmentIds</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">map</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        departmentId </span><span class="token arrow operator" style="color:rgb(212, 212, 212)">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">useDirectEmployeeCount</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">departmentId</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><br></span></code></pre><div class="buttonGroup_WgNt"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Grdj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_cxvn"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_I15G"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Wait! It is a hook and there are rule of hooks. Anoying but still doable.
Lets reimplement <code>useDirectEmployeeCount</code> to support multiple department ids.
Then I can sum them like this.</p>
<div class="language-tsx codeBlockContainer_t37y theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#212432"><div class="codeBlockContent_evnz"><pre tabindex="0" class="prism-code language-tsx codeBlock_eucs thin-scrollbar" style="color:#9CDCFE;background-color:#212432"><code class="codeBlockLines_ir7E"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> departmentCounts </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">useDirectEmployeeCount</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">departmentIds</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> totalCount </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">sum</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">departmentCounts</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><br></span></code></pre><div class="buttonGroup_WgNt"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Grdj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_cxvn"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_I15G"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-tsx codeBlockContainer_t37y theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#212432"><div class="codeBlockContent_evnz"><pre tabindex="0" class="prism-code language-tsx codeBlock_eucs thin-scrollbar" style="color:#9CDCFE;background-color:#212432"><code class="codeBlockLines_ir7E"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">useDirectEmployeeCount</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    departmentIds</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:rgb(78, 201, 176)">Array</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token builtin" style="color:rgb(86, 156, 214)">string</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:rgb(78, 201, 176)">Array</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token builtin" style="color:rgb(86, 156, 214)">number</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(212, 212, 212)">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">useDirectEmployeeIds</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">departmentIds</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">map</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">employeeIds </span><span class="token arrow operator" style="color:rgb(212, 212, 212)">=&gt;</span><span class="token plain"> employeeIds</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">length</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><br></span></code></pre><div class="buttonGroup_WgNt"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Grdj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_cxvn"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_I15G"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>But wait! I need to reimplement <code>useDirectEmployeeIds</code> too. Very anoying.</p>
<div class="language-tsx codeBlockContainer_t37y theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#212432"><div class="codeBlockContent_evnz"><pre tabindex="0" class="prism-code language-tsx codeBlock_eucs thin-scrollbar" style="color:#9CDCFE;background-color:#212432"><code class="codeBlockLines_ir7E"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">useDirectEmployeeIds</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    departmentIds</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:rgb(78, 201, 176)">Array</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token builtin" style="color:rgb(86, 156, 214)">string</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:rgb(78, 201, 176)">Array</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token known-class-name class-name" style="color:rgb(78, 201, 176)">Array</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token builtin" style="color:rgb(86, 156, 214)">string</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;&gt;</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(212, 212, 212)">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">useDepartment</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">departmentIds</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">map</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">department </span><span class="token arrow operator" style="color:rgb(212, 212, 212)">=&gt;</span><span class="token plain"> department</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">directEmployeeIds</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><br></span></code></pre><div class="buttonGroup_WgNt"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Grdj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_cxvn"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_I15G"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>But wait! Grrr...</p>
<div class="language-tsx codeBlockContainer_t37y theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#212432"><div class="codeBlockContent_evnz"><pre tabindex="0" class="prism-code language-tsx codeBlock_eucs thin-scrollbar" style="color:#9CDCFE;background-color:#212432"><code class="codeBlockLines_ir7E"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">useDepartment</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    departmentIds</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:rgb(78, 201, 176)">Array</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token builtin" style="color:rgb(86, 156, 214)">string</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:rgb(78, 201, 176)">Array</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token maybe-class-name">Department</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(212, 212, 212)">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">useQueries</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">departmentIds</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">map</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">departmentId </span><span class="token arrow operator" style="color:rgb(212, 212, 212)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        queryKey</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;departments&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> departmentId</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function-variable function" style="color:rgb(220, 220, 170)">queryFn</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(212, 212, 212)">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">fetch</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token template-string template-punctuation string" style="color:rgb(206, 145, 120)">`</span><span class="token template-string string" style="color:rgb(206, 145, 120)">/departments/</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">${</span><span class="token template-string interpolation">departmentId</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token template-string template-punctuation string" style="color:rgb(206, 145, 120)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">map</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">result </span><span class="token arrow operator" style="color:rgb(212, 212, 212)">=&gt;</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">data</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><br></span></code></pre><div class="buttonGroup_WgNt"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Grdj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_cxvn"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_I15G"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Uf. Done. I&#x27;m glad it is a small project with just three hooks. Tell me the last requirement.</p>
<h2 class="anchor anchorWithStickyNavbar_BFL_" id="limits-with-recursion">Limits with recursion<a href="#limits-with-recursion" class="hash-link" aria-label="Direct link to Limits with recursion" title="Direct link to Limits with recursion">​</a></h2>
<p>Third and last product requirement is simple. User needs to select department and see sum of direct and
indirect employees (including employees from all sub-departments and their sub-departments and so on).
Ok, simple. I already have code for multiple departments. So simply recursively call it and sum the result.</p>
<div class="language-tsx codeBlockContainer_t37y theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#212432"><div class="codeBlockContent_evnz"><pre tabindex="0" class="prism-code language-tsx codeBlock_eucs thin-scrollbar" style="color:#9CDCFE;background-color:#212432"><code class="codeBlockLines_ir7E"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">useIndirectEmployeeCount</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    departmentIds</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:rgb(78, 201, 176)">Array</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token builtin" style="color:rgb(86, 156, 214)">string</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:rgb(78, 201, 176)">Array</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token builtin" style="color:rgb(86, 156, 214)">number</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(212, 212, 212)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> directCount </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">useDirectEmployeeCount</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">departmentIds</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> departments </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">useDepartment</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">departmentIds</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> subDepartmentIds </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> departments</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">flatMap</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">department </span><span class="token arrow operator" style="color:rgb(212, 212, 212)">=&gt;</span><span class="token plain"> department</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">subDepartmentIds</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> indirectCount </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">useIndirectEmployeeCount</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">subDepartmentIds</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> directCount </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> indirectCount</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre><div class="buttonGroup_WgNt"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Grdj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_cxvn"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_I15G"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Wait.</p>
<blockquote>
<mark class="error">Error: Maximum Call Stack Size Exceeded</mark>
</blockquote>
<p>Oh. You almost got me. I just forgot a recursive break, right?</p>
<div class="language-tsx codeBlockContainer_t37y theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#212432"><div class="codeBlockContent_evnz"><pre tabindex="0" class="prism-code language-tsx codeBlock_eucs thin-scrollbar" style="color:#9CDCFE;background-color:#212432"><code class="codeBlockLines_ir7E"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">useIndirectEmployeeCount</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    departmentIds</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:rgb(78, 201, 176)">Array</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token builtin" style="color:rgb(86, 156, 214)">string</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:rgb(78, 201, 176)">Array</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token builtin" style="color:rgb(86, 156, 214)">number</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(212, 212, 212)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> directCount </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">useDirectEmployeeCount</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">departmentIds</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> departments </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">useDepartment</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">departmentIds</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> subDepartmentIds </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> departments</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">flatMap</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">department </span><span class="token arrow operator" style="color:rgb(212, 212, 212)">=&gt;</span><span class="token plain"> department</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">subDepartmentIds</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">subDepartmentIds</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">length</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">===</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> directCount</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">const</span><span class="token plain"> indirectCount </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">useIndirectEmployeeCount</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">subDepartmentIds</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">return</span><span class="token plain"> directCount </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> indirectCount</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre><div class="buttonGroup_WgNt"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Grdj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_cxvn"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_I15G"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Wait.</p>
<blockquote>
<mark class="error">Error: React Hook &quot;useIndirectEmployeeCount&quot; is called conditionally.</mark>
</blockquote>
<p>...</p>
<h2 class="anchor anchorWithStickyNavbar_BFL_" id="last-words">Last words<a href="#last-words" class="hash-link" aria-label="Direct link to Last words" title="Direct link to Last words">​</a></h2>
<p>Mental model stays simple. Everything is a simple function. My app is one big function composed of smaller and
smaller ones. It trully sounds great! But in a real world, hooks are not so simple, homogen and composable.
There are obstacles and limits mainly because of rule of hooks.</p>
<p>This post is not about saying React hooks are bad. I wrote it because I did not find any resources
on such obstacles and limits. The React world looks like hooks are always pleasant walk trought the rosy garden.
But they are not.</p>
<p>For now I don&#x27;t know how to elegantly solve the recusrion example. Are there some resources on this?
Do you have following thougts? Maybe I&#x27;m not the only one struggling.</p>
<p>Thanks for reading.</p>
<!-- -->
<div class="flex gap-2 w-full flex-wrap my-8"><a href="https://x.com/search?q=https%3A%2F%2Fondrejvelisek.github.io%2Fpractical-limits-of-react-hooks-recursion%2F" class="hover:no-underline px-4 py-3 border-solid border rounded border-zinc-700 text-white">Discuss on <svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="x-twitter" class="svg-inline--fa fa-x-twitter" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"></path></svg></a><a href="https://www.reddit.com/r/reactjs/comments/tkog71/practical_limits_of_react_hooks_recursion/" class="hover:no-underline px-4 py-3 border-solid border rounded border-zinc-700 text-white">Discuss on <svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="reddit-alien" class="svg-inline--fa fa-reddit-alien" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M373 138.6c-25.2 0-46.3-17.5-51.9-41l0 0c-30.6 4.3-54.2 30.7-54.2 62.4l0 .2c47.4 1.8 90.6 15.1 124.9 36.3c12.6-9.7 28.4-15.5 45.5-15.5c41.3 0 74.7 33.4 74.7 74.7c0 29.8-17.4 55.5-42.7 67.5c-2.4 86.8-97 156.6-213.2 156.6S45.5 410.1 43 323.4C17.6 311.5 0 285.7 0 255.7c0-41.3 33.4-74.7 74.7-74.7c17.2 0 33 5.8 45.7 15.6c34-21.1 76.8-34.4 123.7-36.4l0-.3c0-44.3 33.7-80.9 76.8-85.5C325.8 50.2 347.2 32 373 32c29.4 0 53.3 23.9 53.3 53.3s-23.9 53.3-53.3 53.3zM157.5 255.3c-20.9 0-38.9 20.8-40.2 47.9s17.1 38.1 38 38.1s36.6-9.8 37.8-36.9s-14.7-49.1-35.7-49.1zM395 303.1c-1.2-27.1-19.2-47.9-40.2-47.9s-36.9 22-35.7 49.1c1.2 27.1 16.9 36.9 37.8 36.9s39.3-11 38-38.1zm-60.1 70.8c1.5-3.6-1-7.7-4.9-8.1c-23-2.3-47.9-3.6-73.8-3.6s-50.8 1.3-73.8 3.6c-3.9 .4-6.4 4.5-4.9 8.1c12.9 30.8 43.3 52.4 78.7 52.4s65.8-21.6 78.7-52.4z"></path></svg></a><a href="https://dev.to/ondrejvelisek/practical-limits-of-react-hooks-recursion-555" class="hover:no-underline px-4 py-3 border-solid border rounded border-zinc-700 text-white">Discuss on <svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="dev" class="svg-inline--fa fa-dev" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M120.12 208.29c-3.88-2.9-7.77-4.35-11.65-4.35H91.03v104.47h17.45c3.88 0 7.77-1.45 11.65-4.35 3.88-2.9 5.82-7.25 5.82-13.06v-69.65c-.01-5.8-1.96-10.16-5.83-13.06zM404.1 32H43.9C19.7 32 .06 51.59 0 75.8v360.4C.06 460.41 19.7 480 43.9 480h360.2c24.21 0 43.84-19.59 43.9-43.8V75.8c-.06-24.21-19.7-43.8-43.9-43.8zM154.2 291.19c0 18.81-11.61 47.31-48.36 47.25h-46.4V172.98h47.38c35.44 0 47.36 28.46 47.37 47.28l.01 70.93zm100.68-88.66H201.6v38.42h32.57v29.57H201.6v38.41h53.29v29.57h-62.18c-11.16.29-20.44-8.53-20.72-19.69V193.7c-.27-11.15 8.56-20.41 19.71-20.69h63.19l-.01 29.52zm103.64 115.29c-13.2 30.75-36.85 24.63-47.44 0l-38.53-144.8h32.57l29.71 113.72 29.57-113.72h32.58l-38.46 144.8z"></path></svg></a></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/conceptual-model-of-react-and-rsc/"><div class="pagination-nav__sublabel">Newer post</div><div class="pagination-nav__label">Conceptual Model of React and RSC</div></a></nav></main><div class="col col--2"><div class="tableOfContents_XeQp thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#model-app" class="table-of-contents__link toc-highlight">Model app</a></li><li><a href="#pleasant-walk-with-basic-hooks" class="table-of-contents__link toc-highlight">Pleasant walk with basic hooks</a></li><li><a href="#obstacles-with-looping" class="table-of-contents__link toc-highlight">Obstacles with looping</a></li><li><a href="#limits-with-recursion" class="table-of-contents__link toc-highlight">Limits with recursion</a></li><li><a href="#last-words" class="table-of-contents__link toc-highlight">Last words</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright"><div class="flex justify-between">
        <div>Copyright © 2025 Ondrej Velisek</div>
        <div>Made with ❤️ in Czech republic.</div>
      </div></div></div></div></footer></div>
</body>
</html>